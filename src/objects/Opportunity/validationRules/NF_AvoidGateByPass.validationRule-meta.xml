<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>NF_AvoidGateByPass</fullName>
    <active>true</active>
    <description>Req 3785 - Merge IWA VRs for Gate bypass (for Aug 2018 Release)</description>
    <errorConditionFormula>AND( 
$Profile.Name&lt;&gt;$Label.Data_Loader_Profile_Name, 
ISCHANGED(StageName), 
NOT(ISPICKVAL( Apttus_Approval__Approval_Status__c , &apos;Approved&apos;)), 

OR( 

AND 
( 
ISPICKVAL( StageName , &apos;Develop Opportunity&apos;), 
OR( 
ISPICKVAL( Business_Type__c , &apos;Standard Opportunity&apos;) , 
ISPICKVAL( Business_Type__c , &apos;Committed Upsell&apos;) 
),
OR( 
NOT(CONTAINS(ApprovalStatusTechField__c , &apos;Approved G2&apos;)), 
AND( 
ISBLANK(ApprovalStatusTechField__c), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Identify Opportunity&apos;) 
) 
) 
), 

AND 
( 
ISPICKVAL( StageName , &apos;Create Offer (Bid)&apos;), 
OR( 
ISPICKVAL( Business_Type__c , &apos;Standard Opportunity&apos;) , 
ISPICKVAL( Business_Type__c , &apos;Committed Upsell&apos;) 
), 
OR( 
NOT(CONTAINS(ApprovalStatusTechField__c , &apos;Approved G3&apos;)), 
AND( 
ISBLANK(ApprovalStatusTechField__c), 
OR( 
ISPICKVAL(PRIORVALUE(StageName),&apos;Identify Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Develop Opportunity&apos;) 
) 
) 
) 
), 

AND 
( 
ISPICKVAL( StageName , &apos;Win the Case (Negotiate)&apos;), 
OR( 
ISPICKVAL( Business_Type__c , &apos;Standard Opportunity&apos;) , 
ISPICKVAL( Business_Type__c , &apos;Committed Upsell&apos;)), 
OR( 
NOT(CONTAINS(ApprovalStatusTechField__c , &apos;Approved G4&apos;)), 

AND( 
ISBLANK(ApprovalStatusTechField__c), 
OR( 
ISPICKVAL(PRIORVALUE(StageName),&apos;Identify Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Develop Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Create Offer (Bid)&apos;) 
) 
) 
) 
), 

AND 
( 
ISPICKVAL(StageName ,&apos;Handover (Prepare for Delivery)&apos;), 
OR( 
NOT(CONTAINS(ApprovalStatusTechField__c , &apos;Approved G5&apos;)), 
AND( 
ISBLANK(ApprovalStatusTechField__c), 
OR( 
ISPICKVAL(PRIORVALUE(StageName),&apos;Identify Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Develop Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Create Offer (Bid)&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Win the Case (Negotiate)&apos;) 
) 
) 
) 
), 

AND( 
ISPICKVAL( StageName , &apos;Execute (Start Delivery)&apos;), 
OR( 
NOT(CONTAINS(ApprovalStatusTechField__c , &apos;Approved G6&apos;)), 
AND( 
ISBLANK(ApprovalStatusTechField__c), 
OR( 
ISPICKVAL(PRIORVALUE(StageName),&apos;Identify Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Develop Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Create Offer (Bid)&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Win the Case (Negotiate)&apos;),
ISPICKVAL(PRIORVALUE(StageName),&apos;Handover (Prepare for Delivery)&apos;) 
) 
)
)
),

AND(
ISPICKVAL( StageName , &apos;Completed&apos;),
OR( 
NOT(CONTAINS(ApprovalStatusTechField__c , &apos;Approved G6&apos;)), 
AND( 
ISBLANK(ApprovalStatusTechField__c), 
OR( 
ISPICKVAL(PRIORVALUE(StageName),&apos;Identify Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Develop Opportunity&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Create Offer (Bid)&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Win the Case (Negotiate)&apos;), 
ISPICKVAL(PRIORVALUE(StageName),&apos;Handover (Prepare for Delivery)&apos;) , 
ISPICKVAL(PRIORVALUE(StageName),&apos;Execute (Start Delivery)&apos;) 
)
) 
) 
)  
)
)</errorConditionFormula>
    <errorMessage>You cannot change the Sales Phase manually. Please submit for approval first.</errorMessage>
</ValidationRule>
