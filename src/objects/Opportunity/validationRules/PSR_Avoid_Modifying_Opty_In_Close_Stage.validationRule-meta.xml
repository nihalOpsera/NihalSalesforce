<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>PSR_Avoid_Modifying_Opty_In_Close_Stage</fullName>
    <active>true</active>
    <description>PreSales : Sprint7 : Req#2287 and Sprint 9 , Req: 3081
  PRIORVALUE(StageName ) = &apos;Submitted For Approval&apos;</description>
    <errorConditionFormula>AND( 
$RecordType.DeveloperName = &apos;Pre_Sales_Risk_Opportunity_read_only&apos;, 
OR(ISPICKVAL(StageName,&apos;Completed&apos;),ISPICKVAL(StageName,&apos;Cancelled&apos;)),
AND(NOT(ISPICKVAL(PRIORVALUE(StageName),&apos;In Execution&apos;)),
NOT(ISPICKVAL(PRIORVALUE(StageName),&apos;Submitted For Approval&apos;)),
NOT(ISPICKVAL(PRIORVALUE(StageName),&apos;Preparation&apos;))),
OR( 
ISCHANGED( PSR_Description_Justification__c ), 
ISCHANGED( PSR_Pre_C5_NPI__c ) , 
ISCHANGED ( CurrencyIsoCode ), 
ISCHANGED ( Name ), 
ISCHANGED ( CloseDate ), 
ISCHANGED (PSR_Date_PO_Received_Or_Cost_Written_off__c) ,
ISCHANGED(PSR_Pre_Sales_Risk_Opportunity_Sub_Type__c), 
AND(TEXT(PRIORVALUE(PSR_Outcome__c)) &lt;&gt; 
TEXT(PSR_Outcome__c),NOT(ISBLANK(TEXT(PRIORVALUE(PSR_Outcome__c))))) 
), 
$Profile.Name &lt;&gt; $Label.Data_Loader_Profile_Name,
NOT(ISPICKVAL(PRIORVALUE(StageName),&apos;Submitted For Approval&apos;))  
 
)</errorConditionFormula>
    <errorMessage>When a Pre-Sales Risk Opportunity is Completed/ Cancelled you can only modify the following fields: Opportunity Owner, Trial Agreement Status (for Trials only)</errorMessage>
</ValidationRule>
