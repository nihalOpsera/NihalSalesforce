<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Restrict_rels_to_301s_legal_entities</fullName>
    <active>true</active>
    <description>Only possible to create account-contact relationships with legal entities under the same 301</description>
    <errorConditionFormula>AND(
NOT(Account.RecordType.Name = &quot;Logistic Account&quot;), 
(
AND(
(NOT (ISNEW() &amp;&amp; IsDirect)) &amp;&amp; (NOT ISCHANGED(IsDirect)),
OR(
NOT(Account.RecordType.Name = &quot;Legal Entity&quot;),
Contact.Account.Id !=  Account.Parent.Id
)
)
)
)</errorConditionFormula>
    <errorDisplayField>AccountId</errorDisplayField>
    <errorMessage>You cannot associate a Contact with a non-legal entity or with a legal entity other than under the contacts primary account</errorMessage>
</ValidationRule>
