var jq=jQuery.noConflict();var updateId=null;var modData={};function showGPListForNewField(d){var f=jq(d).next(".profileData").val();var c=jq(d).next().next(".gridData").val();var b=jq("#displayFolder");var e=jq(d).val();var a;e==""?a="New folder":a=e;b.html(a);jq("#updateFolder").hide();b.css("display","inline-block");if(f!=null&&f!=""){checkProfiles(f)}if(c!=null&&c!=""){checkGrids(c)}checkMaster(jq(".profileList input"),jq("#selectAllProf"));checkMaster(jq(".gridList input"),jq("#selectAllGrids"))}function removeField(){jq(this).parent().remove();jq("#defaultMessage").show();jq("#gridsAndProfiles").hide();jq("#gridsAndProfiles").parent().removeAttr("width");jq("#displayFolder").hide()}function updateNewFolderName(){var a=jq(this).val();a==""?jq("#displayFolder").html("New folder"):jq("#displayFolder").text(a).html()}function highlightText(){var a=jq(".highlight span");var b=jq("a",a);if(!b.hasClass("textHighlight")){b.addClass("textHighlight")}}function checkProfiles(b){var a=jq(".profileList input");jq.each(a,function(d,e){var c=jq(e);if(b.match(c.attr("id"))){c.prop("checked",true)}})}function checkGrids(a){if(jq(".highlight span a").html()==lang.allGrids){var b=jq(".gridList input");b.prop("checked",true);b.prop("disabled",true);jq(".gridHeader input").prop("disabled",true)}else{var c=jq(".gridList span");jq.each(c,function(e,f){var d=a.split(",");var g=jq(f);jq.each(d,function(j,h){if(h==g.html()){g.prev().prop("checked",true);return false}})})}}function updateName(a,b){if(modData[a]){var c=modData[a];if(b==c.origName){if(c.pIds!=null||c.grids!=null){c.name=null}else{delete modData[a];jq("#"+a+"").next().find("a").removeClass("textHighlight")}}else{c.name=b}}else{modData[a]={origName:getOrigName(a),name:b}}}function updateProfiles(){var d=getSelectedProfiles();var b=jq(".highlight");if(b.hasClass("addFolderDiv")){b.find(".profileData").val(d);return}var a=updateId;if(modData[a]){var c=modData[a];if(compToOrigProf(a,d)){if(c.name!=null||c.grids!=null){c.profiles=null}else{delete modData[a];jq("#"+a+"").next().find("a").removeClass("textHighlight")}}else{c.profiles=d}}else{modData[a]={origName:getOrigName(a),profiles:d}}}function updateGrids(){var d=getSelectedGrids();var b=jq(".highlight");if(b.hasClass("addFolderDiv")){b.find(".gridData").val(d);return}var a=updateId;if(modData[a]){var c=modData[a];if(compToOrigGrids(a,d)){if(c.name!=null||c.profiles!=null){c.grids=null}else{delete modData[a];jq("#"+a+"").next().find("a").removeClass("textHighlight")}}else{c.grids=d}}else{modData[a]={origName:getOrigName(a),grids:d}}}function getOrigName(a){var b;jq.each(folderData,function(c,d){if(d.fId==a){b=d.fName;return false}});return b}function compToOrigProf(a,c){var b=false;jq.each(folderData,function(d,e){if(e.fId==a){if(e.pIds==c){b=true}return false}});return b}function compToOrigGrids(b,a){var c=false;jq.each(folderData,function(d,e){if(e.fId==b){if(e.grids==a){c=true}return false}});return c}function getSelectedProfiles(){var b=jq(".profileList input:checked");var a="";jq.each(b,function(c,d){var e=jq(d).attr("id");a=a+e+","});if(a.length>0){a=a.substring(0,a.length-1)}return a}function getSelectedGrids(){var a=jq(".gridList input:checked").next();var b="";jq.each(a,function(d,e){var c=jq(e).html();b=b+c+","});if(b.length>0){b=b.substring(0,b.length-1)}return b}function getChecked(b){var a=false;jq.each(b,function(c,e){var d=jq(e);if(d.prop("checked")==false){d.prop("checked",true);a=true}});return a}function checkMaster(c,b){var a=false;jq.each(c,function(d,f){var e=jq(f);if(e.prop("checked")==false){a=true;return false}});if(!a){b.prop("checked",true)}}function prepGridsProfilesList(a){jq(".highlight").removeClass("highlight");a.addClass("highlight");updateId=jq(".highlight input").attr("id");jq("#defaultMessage").hide();jq("#gridsAndProfiles").show();jq("#gridsAndProfiles").parent().attr("width",jq("#gridsAndProfiles").children()[0].offsetWidth);jq(".profileList input, .gridList input").prop("checked",false);jq("#selectAllProf, #selectAllGrids").prop("checked",false);jq(".gridList input, .gridHeader input").prop("disabled",false)}function showSubmitInProgress(){jq("input[type=submit], .addFolderBtn").addClass("none");jq("input.gbBtnDisabled").removeClass("none");jq(document.body).css("cursor","progress")}function setIsWebKit(){if((/AppleWebKit/).test(navigator.userAgent)){jq("div.gbfPage").addClass("webkit")}}jq(document).ready(function(){var a=jq(".folder a");jq.each(a,function(c,d){var e=jq(d);if(e.html()==lang.allGrids){e.parent().prev().prop("disabled",true)}});var b=jq(".gridList div");if(b.length==0){jq(".gridList").html('<div id="nogrid">'+lang.noGridsInOrg+"</div>");jq(".gridHeader input").hide()}GBButtons.updateAndShowButtons();setIsWebKit();a.click(function(){var i=jq(this);var g=i.parent().prev().attr("id");var h=jq("#updateFolder");var d=jq("#displayFolder");var f=false;var c=false;prepGridsProfilesList(i.parent().parent());if(i.html()==lang.allGrids){h.hide();d.css("display","inline-block");d.html(i.html())}else{h.show();h.val(jq(this).html());d.hide()}if(modData[g]){var e=modData[g];if(e.profiles!=undefined){if(e.profiles!=""){checkProfiles(e.profiles)}f=true}if(e.grids!=undefined){if(e.grids!=""){checkGrids(e.grids)}c=true}}jq.each(folderData,function(j,k){if(k.fId==g){if(!f&&k.pIds&&k.pIds!=""){checkProfiles(k.pIds)}if(!c&&k.grids&&k.grids!=""){checkGrids(k.grids)}return false}});checkMaster(jq(".profileList input"),jq("#selectAllProf"));checkMaster(jq(".gridList input"),jq("#selectAllGrids"));return false});jq(".folder input").click(function(){var c=jq(this);var d=c.prop("checked");var e=c.next();if(d){e.addClass("toDelete")}else{e.removeClass("toDelete")}});jq("#selectAllFol").click(function(){var d=jq(this).prop("checked");var e=jq(".folder input:not(:disabled)");var c=e.next();e.prop("checked",d);if(d){c.addClass("toDelete")}else{c.removeClass("toDelete")}});jq(".profileList input").click(function(){highlightText();updateProfiles()});jq(".gridList input").click(function(){highlightText();updateGrids()});jq("#selectAllProf").click(function(){var d=jq(this).prop("checked");var c=jq(".profileList input");if(d){var e=getChecked(c);if(!e){return}}else{c.prop("checked",d)}highlightText();updateProfiles()});jq("#selectAllGrids").click(function(){var c=jq(this).prop("checked");var e=jq(".gridList input");if(c){var d=getChecked(e);if(!d){return}}else{e.prop("checked",c)}highlightText();updateGrids()});jq("#updateFolder").change(function(){var c=jq(this).val();var d=jq(".folder input");if(c==""){alert(lang.noFolderNameMsg);return}jq.each(d,function(g,h){var e=jq(h).attr("id");if(e==updateId){var j=jq(h).next();var f=jq("a",j);f.addClass("textHighlight");f.text(c).html;updateName(e,c);return false}})});jq(".create-folder .minus").click(removeField);jq(".addFolderBtn").click(function(){var c=jq(".create-folder");jq('<div class="addFolderDiv"><span class="minus">&nbsp;</span><input type="text" maxlength="50" class="addFolder"></input><input type="hidden" class="profileData"/><input type="hidden" class="gridData"/></div>').appendTo(c);var d=c.find(".addFolderDiv:last");d.find("input").focus();prepGridsProfilesList(d);showGPListForNewField(d.find("input[type=text]")[0]);var e=jq(".addFolder");e.click(function(){prepGridsProfilesList(jq(this).parent());showGPListForNewField(this)});e.keyup(updateNewFolderName);jq(".create-folder .minus").click(removeField)});jq(".folderForm").submit(function(){var g=jq(".folder input:checked");if(buttonClicked=="save"){var f={};var c={};var d=jq(".addFolderDiv");var h=false;var f={};jq.each(d,function(o,q){var r=jq(this);var n=r.find(".addFolder").val();var m=r.find(".profileData").val();var p=r.find(".gridData").val();if(n!=null&&n!=""){f[n]={profiles:m,grids:p}}else{if(m||p){alert(lang.noFolderNameMsg);h=true}}});if(h==true){return false}var l;for(propname in f){if(l==true){break}l=true}var k;for(propname in modData){if(k==true){break}k=true}if(l){newDataField.value=JSON.stringify(f)}if(k){modDataField.value=JSON.stringify(modData)}if(!l&&!k){alert(lang.noChange);return false}}else{if(buttonClicked=="delete"){var e="";jq.each(g,function(m,n){var o=jq(n).attr("id");e=e+o+";"});if(e.length>0){if(confirm(lang.confirmFolderDel)){e=e.substring(0,e.length-1);delDataField.value=e}else{var j=jq(".folder input:not(:disabled)");j.prop("checked",false);j.next().removeClass("toDelete");return false}}else{alert(lang.noFolderToDel);return false}}else{if(buttonClicked=="gotogw"){var i=false;var d=jq(".addFolder");jq.each(d,function(m,n){if(jq(n).val()!=""){i=true;return false}});var k;for(propname in modData){if(k){break}k=true}if(k||i==true||g.length>0){if(!confirm(lang.navWarn)){return false}}}}}showSubmitInProgress();modData=null;folderData=null;buttonClicked=null});jq("form.folderForm input[type=submit]").click(function(){var c=jq(this);if(c.hasClass("saveBtn")){buttonClicked="save"}else{if(c.hasClass("delBtn")){buttonClicked="delete"}else{if(c.hasClass("refreshBtn")){buttonClicked="refresh"}else{buttonClicked="gotogw"}}}});jq(".folderForm").attr("autocomplete","off")});