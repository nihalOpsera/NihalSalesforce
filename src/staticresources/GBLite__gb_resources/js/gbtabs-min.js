var jq=jQuery.noConflict();jq(document).ready(function(){jq(".tabsForm").attr("autocomplete","off")});var GBTabsConfig=(function(N,h,m){var A=500,d={},U=[],o={tabs:[]},D=[],S=[],w=[],k,C=false,b=2,x=true,i=[],G={};function B(){var Y={name:"",content:"",id:new Date().getTime()};o.tabs.push(Y);e(Y);F()}function e(aa){var Y=m(".tabListContainer");var Z='<div class="tabDefinition" id="'+aa.id+'"><label>Name: </label><input class="tabNameInput" value="'+aa.name+'" data-field="name" type="text" /><label>Content: </label><input class="tabContentInput" value="'+aa.content+'" placeholder="Search for a Grid or Visualforce page" data-field="content" type="text" /><span class="lookupArrow fvPl" title="Click to see all values, or type in the value field and matching values will appear."></span><span class="removeTab"></span></div>';Y.append(Z);W(aa)}function W(aa){var Y=false;var Z=m("#"+aa.id+" .tabContentInput").autocomplete({minLength:0,source:w,delay:100,select:function(ab,ac){ab.preventDefault();if(ac.item.type=="grid"){m(this).val("{!gridPage}gname="+ac.item.value+"&sh=0&sfname=default").keyup()}else{if(ac.item.type=="ApexPage"){m(this).val("{!URLFOR($Page."+ac.item.value+")}").keyup()}}},source:function(ae,ab){var ad=Y?"":ae.term;var ac=m.ui.autocomplete.filter(w,ad);ab(ac.slice(0,10));if(Y){Y=false}}});m(".tabListContainer").on("click",".lookupArrow",function(){if(Z.is(":visible")){Z.autocomplete("close")}m(this).siblings(".tabContentInput").trigger("keydown");Y=true})}function y(Z){for(var Y=0;Y<o.tabs.length;Y++){if(o.tabs[Y].id==Z.attr("id")){o.tabs.splice(Y,1)}}Z.remove();F()}function T(Y){x=Y.customCodeEnabled;i=Y.customCodeRecords;j(m('[id*="tabbedPagesJson"]').val());f();X();m("#tabbedPageNameInput").val(o.name||"");m("#tabbedPageDescriptionInput").val(o.description||"");m("#tabbedPageGlobalSave").prop("checked",o.globalButtons||true);m('[id*="tabbedPageObjectSelect"]').val(o.object||0);m("#tabbedPageHeightInput").val(o.height||"");m("#tabbedPageShowHeader").prop("checked",o.showHeader||false);m("#tabbedPageShowSidebar").prop("checked",o.showSidebar||false);a();q();m("#addTab").click(B);m(".tabListContainer").on("keyup",".tabDefinition input",function(){g(m(this))});m(".tabSetupContainer").on("change","input, select",function(Z){c()});m(".tabListContainer").on("click",".removeTab",function(){y(m(this).closest(".tabDefinition"));c()});m(".tabsForm input[type=button]").click(function(aa){var Z=false;if(m(this).hasClass("saveBtn")){aa.preventDefault();aa.stopPropagation();P(true);O();Z=p(aa);if(Z==true){saveTabbedPages()}}return false});m("#addPage").click(R);m("#removePage").click(l);m("#launchPage").click(n);m("#pageSelect").change(t);m(".tabListContainer").sortable({items:"div.tabDefinition",update:function(aa,ab){var Z=m(".tabListContainer").sortable("toArray");o.tabs.sort(function(ad,ac){if(Z.indexOf(ad.id.toString())<Z.indexOf(ac.id.toString())){return -1}else{return 1}});c();F()}});if(m.isEmptyObject(d)){R()}E();F();m(".tooltip").tooltipster().focus(function(){m(this).tooltipster("show")}).blur(function(){m(this).tooltipster("hide")});if(x){L();J()}}function f(){if(salesforceBaseURL.indexOf(".com/")>-1){salesforceBaseURL=salesforceBaseURL.substring(0,(salesforceBaseURL.indexOf(".com/")+4))}if(salesforceBaseURL=="/"){salesforceBaseURL="https://"+communityDomain}}function P(Y){var Z=m("input.gbBtn:not(.hidden)"),aa=m("input.gbBtnDisabled:not(.hidden)");if(Y==true){Z.hide();aa.show()}else{Z.show();aa.hide()}}function j(Z){d=JSON.parse(Z);for(var Y in d){d[Y]=JSON.parse(d[Y])}}function c(){if(U.indexOf(o.id)==-1){U.push(o.id)}}function s(Y){m("#tabErrorMessage .msgDetail").html(Y);m("#tabErrorMessage").show()}function O(){m("#tabErrorMessage .msgDetail").html("");m("#tabErrorMessage").hide()}function E(){var aa,Y=[],ab;aa=localStorage.getItem("GBCurrentTabbedPage");for(var Z in d){Y.push('<option value="'+K(d[Z].name)+'">'+K(d[Z].name)+"</option>");if(d[Z].name==aa){ab=aa}}m("#pageSelect").empty().append(Y.join(""));m("#pageSelect").html(m("#pageSelect option").sort(function(ad,ac){aTxt=ad.text.toLowerCase();bTxt=ac.text.toLowerCase();return aTxt==bTxt?0:aTxt<bTxt?-1:1}));if(ab!=undefined){m("#pageSelect").val(ab).change()}else{m("#pageSelect option:eq(0)").attr("selected","selected");t()}}function X(){sforce.connection.batchSize=2000;function Z(){var ac={onSuccess:aa,onFailure:ab,source:{startTime:new Date().getTime()}};var ad={onSuccess:Y,onFailure:ab,source:{startTime:new Date().getTime()}};sforce.connection.query("Select Name, Id, Markup, MasterLabel, NamespacePrefix From ApexPage where NamespacePrefix not in ('GBLite', 'GBFree') and (NOT Name like 'GBTabs_%') order by Name",ac);sforce.connection.query("Select Name, Id, Markup, MasterLabel, NamespacePrefix From ApexPage where Name like 'GBTabs_%' order by Name",ad)}function ab(ac,ad){w=m.merge(m.merge([],gridList),S);k=[]}function aa(ae,ad){if(ae.size>0){for(var ac=0;ac<ae.records.length;ac++){S.push({value:ae.records[ac].Name,label:ae.records[ac].Name+" - Visualforce page",type:"ApexPage"})}}w=m.merge(m.merge([],gridList),S)}function Y(ad,ac){if(ad.size==1){k=[ad.records]}else{if(ad.size>1){k=ad.records}}}Z()}function R(){var Y;Y=v();if(!C){C=true}while(I(Y)){Y=v()}o.name=m("#tabbedPageNameInput").val();o.description=m("#tabbedPageDescriptionInput").val();o.globalButtons=m("#tabbedPageGlobalSave").prop("checked");o.object=m('[id*="tabbedPageObjectSelect"]').val();o.height=m("#tabbedPageHeightInput").val();o.showHeader=m("#tabbedPageShowHeader").prop("checked");o.showSidebar=m("#tabbedPageShowSidebar").prop("checked");o.selectedCustomJSIds=m("#selectedJSCode .customCode.gbSortable").map(function(){return this.id}).get();o.selectedCustomCSSIds=m("#selectedCSSCode .customCode.gbSortable").map(function(){return this.id}).get();u();d[Y]={name:Y,tabs:[],id:new Date().getTime()};o=d[Object.keys(d)[Object.keys(d).length-1]];localStorage.setItem("GBCurrentTabbedPage",Y);B();q();F();a();if(Object.keys(d).length!=1){E()}m("#tabbedPageNameInput").val(Y)}function v(){var Y;if(C){Y="New Page "+b;b++}else{Y="New Page"}return Y}function I(Y){for(var Z in d){if(d[Z].name==Y){return true}}return false}function l(){var Y=confirm("Are you sure you want to delete this tabbed page? The Visualforce page will be also deleted.");if(Y){P(true);for(var aa in d){if(d[aa].name==o.name){d[aa]={};break}}var Z=z(o);if(Z){if(m("#pageSelect option:eq(1)").length==0){localStorage.removeItem("GBCurrentTabbedPage")}p();saveTabbedPages()}}}function n(){N.open(salesforceBaseURL+unmanagedVFPrefix+o.pageAPIName)}function t(){var Y=m("#pageSelect").val();o.name=m("#tabbedPageNameInput").val();o.description=m("#tabbedPageDescriptionInput").val();o.globalButtons=m("#tabbedPageGlobalSave").prop("checked");o.object=m('[id*="tabbedPageObjectSelect"]').val();o.height=m("#tabbedPageHeightInput").val();o.showHeader=m("#tabbedPageShowHeader").prop("checked");o.showSidebar=m("#tabbedPageShowSidebar").prop("checked");o.selectedCustomJSIds=m("#selectedJSCode .customCode.gbSortable").map(function(){return this.id}).get();o.selectedCustomCSSIds=m("#selectedCSSCode .customCode.gbSortable").map(function(){return this.id}).get();for(var aa in d){if(d[aa].name==Y){o=d[aa];break}}u();for(var Z=0;Z<o.tabs.length;Z++){e(o.tabs[Z])}m("#tabbedPageNameInput").val(o.name);m("#tabbedPageDescriptionInput").val(o.description);m("#tabbedPageGlobalSave").prop("checked",o.globalButtons);m('[id*="tabbedPageObjectSelect"]').val(o.object||0);m("#tabbedPageHeightInput").val(o.height);m("#tabbedPageShowHeader").prop("checked",o.showHeader);m("#tabbedPageShowSidebar").prop("checked",o.showSidebar);a();q();localStorage.setItem("GBCurrentTabbedPage",o.name)}function q(){if(o.pageAPIName!=undefined){m("#tabbedPageAPIName").css("display","table-row");m("#tabbedPageAPIName span").text(o.pageAPIName);m("#launchPage").show();m(".launchBtn").removeClass("hidden");m("#removePage").show();m(".deleteBtn").removeClass("hidden")}else{m("#tabbedPageAPIName").css("display","none");m("#launchPage").hide();m(".launchBtn").addClass("hidden");m("#removePage").hide();m(".deleteBtn").addClass("hidden")}}function u(){m("#tabbedPageNameInput").val("");m("#tabbedPageDescriptionInput").val("");m("#tabbedPageGlobalSave").prop("checked",true);m('[id*="tabbedPageObjectSelect"]').val(0);m("#tabbedPageHeightInput").val("");m("#tabbedPageShowHeader").prop("checked",false);m("#tabbedPageShowSidebar").prop("checked",false);m(".tabListContainer").empty();F()}function Q(af){var Z=[];for(var ad=0;ad<af.length;ad++){var ae=new sforce.SObject("ApexPage");var Y=(af[ad].object!=0)?'standardController="'+af[ad].object+'"':"";ae.Name="GBTabs_"+af[ad].name.split(" ").join("_");ae.MasterLabel=af[ad].name;ae.Markup=H(Y,ae,af[ad]);ae.isAvailableInTouch=true;Z.push(ae)}var ac=sforce.connection.create(Z);for(var ab=0;ab<ac.length;ab++){if(ac[ab].success=="false"){s("Unable to save tabbed page. There was an error creating the Visualforce page. Please correct the error and try again by hitting save: "+ac[ab].errors.message);P(false);return false}}for(var aa=0;aa<af.length;aa++){af[aa].pageAPIName="GBTabs_"+af[aa].name.split(" ").join("_")}return true}function V(ae){var Z=[];for(var aa=0;aa<ae.length;aa++){var ad;for(var ac=0;ac<k.length;ac++){if(k[ac].Name==ae[aa].pageAPIName){ad=k[ac]}}if(!ad){continue}delete ad.NamespacePrefix;var Y=(ae[aa].object!=0)?'standardController="'+ae[aa].object+'"':"";ad.Markup=H(Y,ad,ae[aa]);Z.push(ad)}var ab=sforce.connection.update(Z);for(var ac=0;ac<ab.length;ac++){if(ab[ac].success=="false"){s("Unable to save tabbed page. There was an error updating the Visualforce page. Please correct the error and try again by hitting save: "+ab[ac].errors.message);P(false);return false}}return true}function H(Y,ab,aa){var Z="<apex:page "+Y+' showHeader="'+aa.showHeader+'" sidebar="'+aa.showSidebar+'" title="'+aa.name+'">\n\t<'+namespacePrefix+':TabbedPageComponent  pageAPIName="'+ab.Name+'" customJsIds="'+aa.selectedCustomJSIds.join(",")+'" customCssIds="'+aa.selectedCustomCSSIds.join(",")+'">\n\t<'+namespacePrefix+':EmbedComponent baseGridUrl="{!$Page.'+namespace+'Grid}" />\n\t\t<script>\n\t\t\tvar pageDefinition = '+JSON.stringify(aa,null,"\t")+";\n\t\t<\/script>\n\t</"+namespacePrefix+":TabbedPageComponent>\n</apex:page>";return Z}function z(ab){var aa;for(var Z=0;Z<k.length;Z++){if(k[Z].Name==ab.pageAPIName){aa=k[Z]}}if(aa==undefined){return true}var Y=sforce.connection.deleteIds([aa.Id]);if(Y[0].success=="true"){return true}else{s("There was an error deleting the Visualforce page. Please correct the error and try again by hitting save: "+Y[0].errors.message);P(false);return false}}function p(af){var Y=true,ab=true,ac=true;o.name=m("#tabbedPageNameInput").val();o.description=m("#tabbedPageDescriptionInput").val();o.globalButtons=m("#tabbedPageGlobalSave").prop("checked");o.object=m('[id*="tabbedPageObjectSelect"]').val();o.height=m("#tabbedPageHeightInput").val();o.showHeader=m("#tabbedPageShowHeader").prop("checked");o.showSidebar=m("#tabbedPageShowSidebar").prop("checked");o.selectedCustomJSIds=m("#selectedJSCode .customCode.gbSortable").map(function(){return this.id}).get();o.selectedCustomCSSIds=m("#selectedCSSCode .customCode.gbSortable").map(function(){return this.id}).get();if(o.name!=undefined){localStorage.setItem("GBCurrentTabbedPage",o.name)}var ae=[],aa=[];for(var ad in d){if(m.isEmptyObject(d[ad])){continue}if(d[ad].name==""){s("Unable to save: Please add a title to all tabbed pages.");P(false);return false}for(var Z=0;Z<d[ad].tabs.length;Z++){if(d[ad].tabs[Z].name==""){s("Unable to save: Please add a name to all tab definitions in the "+K(d[ad].name)+" page.");P(false);return false}}if(d[ad].pageAPIName==undefined){ae.push(d[ad])}else{if(U.indexOf(d[ad].id)!=-1){aa.push(d[ad])}}}if(Q(ae)==false||V(aa)==false){Y=false}if(Y==true){m('[id*="tabbedPagesJson"]').val(JSON.stringify(d));return true}else{return false}}function g(Z){var ab=Z.closest(".tabDefinition"),aa=Z.attr("data-field");for(var Y=0;Y<o.tabs.length;Y++){if(o.tabs[Y].id==ab.attr("id")){o.tabs[Y][aa]=K(Z.val())}}F()}function F(){var ab="<ul>",Y;if(o.tabs==undefined){return}for(var aa=0;aa<o.tabs.length;aa++){if(o.tabs[aa].name==""){Y=" "}else{Y=o.tabs[aa].name}ab+='<li><a href="#tabs-'+aa+1+'">'+Y+"</a></li>"}ab+="</ul>";for(var Z=0;Z<o.tabs.length;Z++){ab+='<div id="tabs-'+Z+1+'"><h1>Content: '+K(o.tabs[Z].content)+"</h1></div>"}if(m(".tabbedPreviewContainer").hasClass("ui-tabs")){m(".tabbedPreviewContainer").tabs("destroy")}if(o.tabs.length>0){m(".tabbedPreviewContainer").empty().append(ab).tabs()}}function L(){var ad=[],af=[],ah=[],ai=[],ag,Y,ae=false,Z=false;m("#availableCSSCode").empty();m("#availableJSCode").empty();m("#selectedCSSCode").empty();m("#selectedJSCode").empty();m("#availableCSSCode").find(".customCodeInfo").text("");m("#availableJSCode").find(".customCodeInfo").text("");if(!o.selectedCustomCSSIds){o.selectedCustomCSSIds=[]}if(!o.selectedCustomJSIds){o.selectedCustomJSIds=[]}for(var ac=0;ac<i.length;ac++){ag=i[ac];G[ag.codeId]=ag;if(ag.codeType=="CSS"){Y=o.selectedCustomCSSIds.indexOf(ag.codeId)>-1;ae=true;if(!Y){ad=ad.concat(M(ag,true))}}else{if(ag.codeType=="JavaScript"){Y=o.selectedCustomJSIds.indexOf(ag.codeId)>-1;Z=true;if(!Y){af=af.concat(M(ag,true))}}else{if(ag.codeType=="Global CSS"){ah=ah.concat(M(ag,false,true))}else{if(ag.codeType=="Global JavaScript"){ai=ai.concat(M(ag,false,true))}}}}}for(var ab=0;ab<o.selectedCustomCSSIds.length;ab++){ag=G[o.selectedCustomCSSIds[ab]];if(!ag){continue}ah=ah.concat(M(ag,false))}for(var aa=0;aa<o.selectedCustomJSIds.length;aa++){ag=G[o.selectedCustomJSIds[aa]];if(!ag){continue}ai=ai.concat(M(ag,false))}if(ad.length>0){m("#availableCSSCode").find(".customCodeInfo").addClass("none")}else{m("#availableCSSCode").find(".customCodeInfo").removeClass("none")}if(ae){m("#availableCSSCode").find(".customCodeInfo").text("All selected.")}if(af.length>0){m("#availableJSCode").find(".customCodeInfo").addClass("none")}else{m("#availableJSCode").find(".customCodeInfo").removeClass("none")}if(Z){m("#availableJSCode").find(".customCodeInfo").text("All selected.")}if(ah.length>0){m("#selectedCSSCode").find(".customCodeInfo").addClass("none")}else{m("#selectedCSSCode").find(".customCodeInfo").removeClass("none")}if(ai.length>0){m("#selectedJSCode").find(".customCodeInfo").addClass("none")}else{m("#selectedJSCode").find(".customCodeInfo").removeClass("none")}m("#availableCSSCode").append(ad.join(""));m("#availableJSCode").append(af.join(""));m("#selectedCSSCode").append(ah.join(""));m("#selectedJSCode").append(ai.join(""));m("#selectedCSSCode .tooltip").tooltipster().focus(function(){m(this).tooltipster("show")}).blur(function(){m(this).tooltipster("hide")});m("#selectedJSCode .tooltip").tooltipster().focus(function(){m(this).tooltipster("show")}).blur(function(){m(this).tooltipster("hide")})}function M(ac,aa,Z){var Y=[],ab=["customCode"];if(!aa&&!Z){ab.push("gbSortable")}if(Z){ab.push("globalCustomCode")}Y.push('<div class="'+ab.join(" ")+'" id="'+ac.codeId+'">');if(aa){Y.push('<span class="gbAddCode"></span>')}else{if(!Z){Y.push('<span class="gbRemoveCode"></span>')}else{Y.push('<span class="gbInfoIcon tooltip" title="This is global code that\'s applied to all grids." tabindex="0"/>')}}Y.push("<span>"+ac.summary+"</span>");Y.push("</div>");return Y}function J(){m(".customCodeBlock").on("click",".gbAddCode, .gbRemoveCode",function(){r(m(this))});m("#selectedCSSCode, #selectedJSCode").sortable({items:"div.gbSortable",stop:function(Z,Y){c()}})}function r(Y){var aa=Y.closest(".customCodeBlock.css").length>0,ac=(aa?m("#availableCSSCode"):m("#availableJSCode")),Z=(aa?m("#selectedCSSCode"):m("#selectedJSCode")),ab=Y.closest("div.customCode").attr("id");c();if(Y.hasClass("gbAddCode")){ac.find("#"+ab).remove();Z.append(M(G[ab],false).join(""));Z.sortable({items:"div.gbSortable"});Z.find(".customCodeInfo").addClass("none");if(ac.find(".customCode").length==1){ac.find(".customCodeInfo").removeClass("none")}}else{Z.find("#"+ab).remove();ac.append(M(G[ab],true).join(""));if(Z.find(".customCode").length==1){Z.find(".customCodeInfo").removeClass("none")}if(ac.find(".customCode").length>1){ac.find(".customCodeInfo").addClass("none")}}}function a(){L()}function K(Z){var Y=Z.replace(/&/g,"&amp;");Y=Y.replace(/'/g,"&#39;");Y=Y.replace(/"/g,"&#34;");Y=Y.replace(/</g,"&lt;");Y=Y.replace(/>/g,"&gt;");return Y}return{init:T,toggleButtonState:P}})(window,document,jq);var GBTabs=(function(d,h,b){var e=500,g={},f;function l(){f=baseGridURL.substring(0,baseGridURL.indexOf(".com")+4);k();b("#saveAllGridsBtn, #refreshAllGridsBtn").click(function(){var n=b(this).attr("data-action")||"saveGrid",o=b(".gridFrame");var m={action:n};o.each(function(){c(b(this).parent());b(this)[0].contentWindow.postMessage(JSON.stringify(m),f)})});i();j("tabs-1")}function c(m){if(b(m).css("display")=="none"){var n="updatable-inner-elements";b(m).addClass(n);setTimeout(function(){b(m).removeClass(n)},100)}}function k(){if(pageDefinition.description!=""){b("#pageDescription").text(pageDefinition.description)}else{b("#pageDescription").hide()}if(pageDefinition.globalButtons==true){b(".globalButton").show()}if(navigator.userAgent.indexOf("iPad")>-1){var m=((pageDefinition.height?(pageDefinition.height*1):e)+50);b("#tabsContainer").addClass("gb-mobile").height(m)}}function i(){var o="<ul>";for(var n=0;n<pageDefinition.tabs.length;n++){o+='<li><a href="#tabs-'+(n+1)+'">'+pageDefinition.tabs[n].name+"</a></li>";g["tabs-"+(n+1)]=pageDefinition.tabs[n].content}o+="</ul>";for(var m=0;m<pageDefinition.tabs.length;m++){o+='<div id="tabs-'+(m+1)+'"></div>'}if(b("#tabsContainer").hasClass("ui-tabs")){b("#tabsContainer").tabs("destroy")}b("#tabsContainer").empty().append(o).tabs({activate:function(q,r){var p=r.newTab.find("a").attr("href").substring(1);j(p)}})}function j(s){var r=g[s],n=pageDefinition.height.replace("px","");if(isNaN(n*1)||n*1==0){n=e}else{n=(n*1)-57}if(r&&r.length>0){var m=h.getElementById(s),o=a("ilca"),p=a("isdtp");if(o=="1"){var q=a("lexo");r+="&ilca=1&itp=1";r+="&lexo="+q}if(p&&p!="p1"){r+="&isdtp="+p}if(m.innerHTML.length==0){m.innerHTML='<iframe class="gridFrame" scrolling="auto" height="'+n+'" width="100%" frameborder="0" src="'+r+'"></iframe>'}}}function a(o){var n=d.location.search,p="";if(n){var m=n.split("&");b.each(m,function(q,r){if(r.match(o+"=")){p=r.substring(r.indexOf("=")+1);return false}})}return p}return{init:l}})(window,document,jq);