var jq=jQuery.noConflict();var objectDotFields=new Array();var selectedObjects=new Array();var selectedObjectsReadable=new Array();var selectedObjectHolders=new Array();var selectedObjWrappers=new Array();var retrievedObjectsFromAJAX=new Array();var btnClick;var saveAlreadyRun;var validationMessage_oneParentFieldRequired=lang.selectField;var validationMessage_maxFieldsPerObject=lang.maxFieldObj;var validationMessage_maxFieldsPerGrid=lang.maxFieldGr;var validationMessage_max4ChildrenPerGrid=lang.maxChildObj;var loadPageObjectNames=[];var selectedObjectNames=[];if(typeof String.prototype.endsWith!=="function"){String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1}}jq(document).ready(function(){GBMixpanel.init(mpToken);GBMixpanel.track("Page View",{Page:"GW2"});JSObjectHelper.init();GBButtons.updateAndShowButtons();GBFields.init();setIsWebKit();GBCRUDSettings.init();GBChartsConfig.init();GBEmbedChart.init();GBSearch.init();GBColorCoding.init();e();jq(".closeX").click(function(){a()}).keyup(function(m){if(m.keyCode==13){jq(this).trigger("click")}});jq("#vldWarning").click(function(m){m.stopPropagation()});jq(document).keyup(function(m){if(m.keyCode==27){a();g()}});jq(".gbwForm input[type=submit]").click(function(){if(jq(this).hasClass("saveBtn")){btnClick="save"}else{btnClick=null}});jq(".gbwForm").submit(function(t){GBFields.populateObjectDotFieldsForSave();if(btnClick=="save"){var s=false,v="";var q=GBChartsConfig.updateChartsJSONForSave();if(q.length>0){v+='See the <a href="#chartSection">Chart section</a> for additional errors.<br>';GBChartsConfig.showErrorMessage(q.join("<br>"))}else{GBChartsConfig.hideErrorMessage()}GBCRUDSettings.updateCRUDSettingsJSONForSave();var u=j();if(u!==null&&u!==undefined){v+=u+"<br>"}var z=f();if(z!==null&&z!==undefined){v+=z+"<br>"}var r=h();if(r!==null&&r!==undefined){v+=r+"<br>"}var y=l();if(y!==null&&y!==undefined){v+=y+"<br>"}var m=d();if(m!==null&&m!==undefined){v+=m+"<br>"}var p=GBFields.validateUnrelatedRelationships();if(p!==null&&p!==undefined){v+=p+"<br>";s=true}if(!s){var n=GBFields.validateRelationshipFieldDataTypes();if(n!==null&&n!==undefined){v+=n+"<br>"}}if(GBDataCardSettings.isFeatureEnabled()&&c()){v+="Select at least one Primary Field.<br>"}var o=GBColorCoding.updateColorsJSONForSave();if(o.length>0){GBColorCoding.showErrorMessage(o.join("<br>"));v+='See the <a href="#cfSection">Conditional Formatting section</a> for additional errors.'}else{GBColorCoding.hideErrorMessage()}if(v!=""){var x=jq(".saveBtn").get(0);showWarningMessage(x,v,t);return false}if(hasAnyUserDefinedFilter||hasAdminFiltersExceptDefault){var w=i();if(w!=null){if(!window.confirm(lang.saveGW2StartWarningTxt+w+lang.saveGW2EndWarningTxt)){return false}}}GBFieldProps.updatePropsJSONForSave();GBFields.updateRelationshipsJSON();GBMixpanel.pageLevelSubmit()}b();return save()});k();function e(){var p=jq(".selectedFieldsContent .objField");for(var m=0;m<p.length;m++){var n=GBFields.getFieldObjectProperties(jq(p[m]));var o=n.objectName;if(jq.inArray(o,loadPageObjectNames)===-1){loadPageObjectNames.push(o)}}}function i(){var m=[];for(var s=0;s<selectedObjectNames.length;s++){if(loadPageObjectNames.indexOf(selectedObjectNames[s])===-1){var v=GBFields.objectNameToLabelMap[selectedObjectNames[s]];m.push(lang.saveGW2ObjectAddedWarningTxt.replace("{0}",v))}}var n=[];for(var r=0;r<loadPageObjectNames.length;r++){if(selectedObjectNames.indexOf(loadPageObjectNames[r])===-1){var o=GBFields.objectNameToLabelMap[loadPageObjectNames[r]];n.push(lang.saveGW2ObjectRemovedWarningTxt.replace("{0}",o))}}var t=GBCRUDSettings.getChangedFlatViewObjectNames();var p=[];for(var q=0;q<t.length;q++){var u=GBFields.objectNameToLabelMap[t[q]];p.push(lang.saveGW2FlatViewChangedWarningTxt.replace("{0}",u))}var w=m.concat(n.concat(p));if(w.length>0){return w.join(", ")+". "}return null}function b(){jq("input[type=submit]").addClass("none");jq("input.gbBtnDisabled").removeClass("none");jq(document.body).css("cursor","progress")}function j(){if((jq.inArray(parentObjectName,selectedObjects)==-1)||objectDotFields.length==0){return validationMessage_oneParentFieldRequired}}function f(){var m=jq(String.format('.selectedFieldsContent div[id="{0}"]',parentObjectName)).find(".objField").first();if(m.hasClass("dvc")){return lang.firstFieldMustBeParentField}}function h(){if(maxFieldsPerObject!=-1&&maxFieldsPerObject<maxFieldsPerGrid){for(var n=0;n<selectedObjWrappers.length;n++){var m=selectedObjWrappers[n].fields;if(m!==undefined&&m!==null&&m.length>maxFieldsPerObject){return validationMessage_maxFieldsPerObject}}}}function l(){if(maxFieldsPerGrid!=-1&&objectDotFields.length>maxFieldsPerGrid){return validationMessage_maxFieldsPerGrid}}function d(){if(selectedObjects.length>5){return validationMessage_max4ChildrenPerGrid}}function c(){return jq(".selectedFieldsContent").find(".primaryFieldsSection").filter(function(){return jq(this).find(".objField").length==0}).length>0}function a(){if(jq("#vldWarning").is(":visible")==true){jq("#vldWarning").hide()}}function g(){if(jq("#gbFieldPropPopup").is(":visible")){GBFieldProps.hidePropsWidget()}if(jq("#objectLevelCRUD").is(":visible")){GBCRUDSettings.toggleObjectLevelCRUDWidget(false)}}function k(){jq("div.sectionHeader").click(function(){var o=jq(this),n=o.find(".ui-icon"),m=jq(this).next("div.sectionContent");if(m.hasClass("none")){m.removeClass("none");n.removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-s")}else{m.addClass("none");n.removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e")}})}jq(".launchGridLink").on("click",function(){GBWindowsUtil.openWindow(launchGridURL)});jq(".gbwForm").attr("autocomplete","off")});var GBFields=(function(ao,K,q){var aw={},r,ac=0,av,Z={},L={},M=[],ae={},g=[],n,G,p="REFERENCE",ab=["COMBOBOX","DOUBLE","EMAIL","ID","INTEGER","REFERENCE","PHONE","PICKLIST","STRING","URL"],a=["COMBOBOX","EMAIL","PHONE","PICKLIST","STRING","URL"],al=["INTEGER","DOUBLE"],I=["ID","REFERENCE","STRING"],O={COMBOBOX:a,EMAIL:a,ID:I,INTEGER:al,DOUBLE:al,REFERENCE:I,PHONE:a,PICKLIST:a,STRING:q.merge(a,I),URL:a},o={Product2:"OpportunityLineItem",Account:"EventRelation"},ah="RecordTypeId",aq="Task",s="Event",T="User",x="SelfServiceUser",b="MilestoneType",ax="CaseTeamTemplateMember",X="CaseTeamRole",U="ProcessNode",A="Group",E=false;var C=JSON.parse(q('[id*="crudSettingsJson"]').val()),m=JSON.parse(q("[id*='fieldPropsJson']").val()),d=JSON.parse(q("[id*='adminFieldPropsJson']").val()),ag={"Process Instance History":"Approval History","Process Instance":"Approval"};function Y(){n=JSON.parse(q('[id*="relationships"]').val());V(selectedFieldObjects);D();w();P();l();R();F();E=true}function Q(){return g}function i(aB,aA,az){var ay;if(aB!==null&&aB!==undefined&&aA!==null&&aA!==undefined){if(az!==null&&az!==undefined&&az!="null"&&az!=""&&az!=" "){ay=aB+":"+aA+":"+az}else{ay=aB+":"+aA}}return ay}function v(aD){var aC=new Object(),aD=q(aD),aH=aD.attr("data-odf"),ay=aD.children(".fieldLabel").text().trim(),aF=aD.attr("data-fdt"),aE=aH.split(":"),az=aE.length,aB=aE[0],aG=aE[1],aA=(az==3?aE[2]:"");aC.labelName=ay;aC.objectName=aB;aC.fieldName=aG;aC.objectFk=aA;aC.dataType=aF;return aC}function am(){objectDotFields=new Array();selectedObjects=new Array();selectedObjectNames=[];selectedObjectsReadable=new Array();selectedObjWrappers=new Array();var az=q(".selectedFieldsContent .objField");for(var aA=0;aA<az.length;aA++){var aE=GBFields.getFieldObjectProperties(q(az[aA]));var aB=aE.objectName;var aI=aE.fieldName;var aC=aE.objectFk;var aD=aB+aC;var aG=aB+(aC?":"+aC:"");var aJ;var aH=GBFields.constructObjectDotField(aB,aI,aC);if(q.inArray(aH,objectDotFields)==-1){objectDotFields.push(aH)}if(q.inArray(aB,selectedObjectNames)===-1){selectedObjectNames.push(aB)}if(q.inArray(aD,selectedObjects)==-1){selectedObjects.push(aD);aJ=new selectedObject(aD);aJ.fields.push(aI);selectedObjWrappers.push(aJ);selectedObjectsReadable.push(aG)}else{for(var ay=0;ay<selectedObjWrappers.length;ay++){var aF=selectedObjWrappers[ay].objectName;if(aD==aF){selectedObjWrappers[ay].fields.push(aI)}}}}}function j(){var aE={},aA,aC,aD,aB,ay,aG,az,aH,aF;q(".selectedFieldsContent .relWidget").each(function(){aA=q(this);aC=aA.find(".objSection.child");aD=aC.children(".relOptions").attr("data-objectDotFk");aB=aD.split(":")[0];ay=aC.find(".relOptions select option:selected").val();aG=aA.find(".objSection.parent select option:selected").val();aE[aB]={parentField:aG,unrelatedField:ay}});q(".selectedFieldsContent .selectedObjectSection").each(function(){aD=q(this).attr("id");aH=q(this).attr("data-codf");if(aH){aD=aH}if(aD.indexOf("-")>-1){aF=aD.replace(":unrelated-","-");az=q(this).attr("data-parentObjectFkName");aE[aF]={gridParentObjectFkName:az}}});q('[id*="relationships"]').val(JSON.stringify(aE))}function D(){var aE=q(".objectsContainer .relatedChildObjects"),aK=q(".objectsContainer .allObjects"),aG=childObjects.length,aH,az=[],aI,aJ=allObjects.length,aB,aF,aD,ay=[],aC;q(".objectsContainer .parentObjectName").append(H(parentObjectName,"",parentObjectLabel,"Parent"));for(aC=0;aC<aG;aC++){var aA;aH=childObjects[aC];if(aH.parentLabel in ag){aA=ag[aH.parentLabel]}else{aA=aH.parentLabel}az.push(H(aH.parentName,aH.foreignKeyRelName,aA,aH.childRelName))}if(az.length>0){aE.removeClass("noData").append(az.join(""))}else{aE.addClass("noData").append("No related objects.")}for(aC=0;aC<aJ;aC++){aB=allObjects[aC].split(":");aF=aB[0];aD=aB[1];aw[aF]=aD;if(unsupportedUnrelatedObjects.indexOf(aF)===-1){ay.push(H(aF,"unrelated",aD,aF,(aC+1)))}}aK.append(ay.join(""))}function H(aE,aC,aD,aB,aA){var ay=au(aD),az=au(aB||"");return'<div class="objName" data-objectDotFk="'+W(aE,aC)+'"'+(aA?'data-index="'+aA+'"':"")+'><span class="objectLabel">'+ay+'</span> <span class="relName">'+az+"</span></div>"}function l(){var aA=(selectedFieldObjects?selectedFieldObjects.length:0),aG,aO,aL,az,aN,aM,aH,aD,aK,aJ,aE,aB={},aF,aI,ay,aC;if(selectedFieldObjects&&aA>0){for(aC=0;aC<aA;aC++){aF=selectedFieldObjects[aC];if(!aF){continue}aD=aF.parentName;aG=W(aD,aF.foreignKeyRelName);aO=i(aD,aF.name,aF.foreignKeyRelName);aH=f(aF);if(invalidObjects.hasOwnProperty(aG)){aK=undefined}else{if(aD=="ProcessInstanceHistory"){aK="Approval History"}else{aK=aw[aD]}}aL=aF.configName.split(":");aJ=(aL.length==2);aE=(aL.length==3&&aL[2].indexOf("unrelated")>-1&&aL[2].indexOf("-")==-1),isJunctionParent=(aL.length==3&&aL[2].indexOf("unrelated")>-1&&aL[2].indexOf("-")>-1),gridParentObjectFkName=(isJunctionParent?ai(aG):null);if(aE){aB[aG]=aK}aj(null,aG,aO,aF.displayLabel,aF.name,aF.fieldDataType,aH,aD,aK,aJ,aE,gridParentObjectFkName)}for(ay in aB){aI=aB[ay];h(ay,aI)}}}function V(az){if(!az||az.length==0){return}var aA=az.length,aC,aD,ay=[],aB;for(aB=0;aB<aA;aB++){aC=az[aB];if(!aC){continue}aD=i(aC.parentName,aC.name,aC.foreignKeyRelName);ae[aD]=aC}}function ai(aA){if(!n||q.isEmptyObject(n)){return null}var az=aA.replace(":unrelated-","-"),ay=n[az];return ay.gridParentObjectFkName}function w(){var ay=q(".objectsContainer"),az=q(".fieldsContainer");ay.on("click",".objName",function(){GBSearch.clearSearchForChooseFieldsSection();y(this)});az.on("click",".gbDrillUp, .gbDrillBack",function(){GBSearch.clearSearchForChooseFieldsSection();y(this)});az.on("click",".junctionParent",function(){q(".fieldsContainer .gbDrillBack").click()});az.on("click",".gbAddField",function(){aa(this,true);G=(G+1);af(G)});az.on("keydown",".gbAddField",function(aA){if(aA.keyCode==13||aA.keyCode==32){q(this).click()}});q(".selectedFieldsContainer").on("click",".gbRemoveField",function(){var aA=aa(this,false);if(aA){G=(G-1);af(G)}});q(".selectedFieldsContainer").on("keydown",".gbRemoveField",function(aA){if(aA.keyCode==13||aA.keyCode==32){q(this).click()}});q(".selectedObjectSection").sortable({items:"div.objField"});q(".showFieldAPINameLink").click(function(){var aA=q(".showHideApiLink").hasClass("shown");if(aA){q(".showFieldAPINameLink span").text("Hide field API names");q(".fieldApiName").removeClass("hidden");q(".showHideApiLink").removeClass("shown")}else{q(".showFieldAPINameLink span").text("Show field API names");q(".fieldApiName").addClass("hidden");q(".showHideApiLink").addClass("shown")}GBSearch.refreshFieldSearch()});ay.find(".objectsContent .objectHeading .tooltip").tooltipster().focus(function(){q(this).tooltipster("show")}).blur(function(){q(this).tooltipster("hide")})}function y(aF){var ay=q(aF),aB=ay.attr("data-objectDotFk"),aE=ay.attr("data-junctionObjectDotFk"),aH=ay.parents(".fieldsContent").children(".selectedObject").find(".selectedObjectLabel").text().trim(),aA=ay.find(".relName").text().trim(),az=ay.siblings(".fieldLabel").text(),aD=Z[aB],aG;if(ay.hasClass("gbDrillUp")){var aC=ay.parent(".objField").attr("data-referencetoobjectname");aG=aw[aC]||aC}else{if(ay.hasClass("gbDrillBack")){aG=ay.parent(".drillBackRow").children(".junctionParent").text().trim()}else{aG=ay.find(".objectLabel").text().trim()}}q(".fieldsContainer .objectFields").html('<div class="loadingText">'+lang.loading+"</div>");q(".fieldsContainer .selectedObject").html('<span class="selectedObjectLabel">'+au(aG)+'</span><span class="relName">'+au(aA)+"</span>");if(aD&&aD.length>0){S(aB,aD,aE,aH,aA,az)}else{c(aB,aE,aH,aA,az,null)}av=aB}function W(az,ay){return az+(ay?(":"+ay):"")}function c(aH,aI,aJ,aE,aA,aF){var aC=aH.split(":"),aB=aC[0],az=aC[1],ay={reqtype:"objectFields",oan:aB,fkn:az};var aG=++ac,aD=[];q.ajax({type:"POST",url:lookupAjaxResponderPageURL,data:ay,dataType:"json",success:function(aK){if(!aK){return}if(aK.status=="success"){aD=aK.fields||[];Z[aH]=aD;V(aD);if(aF){if(!Z[parentObjectName]){c(parentObjectName,null,null,null,null,aH)}else{h(aF,null)}}else{S(aH,aD,aI,aJ,aE,aA)}}else{q(".fieldsContainer .objectFields").html("<div>"+aK.message+"</div>")}}})}function S(aM,aJ,aR,aE,aQ,aK){var aN=q(".fieldsContainer .selectedObject"),aG=q(".fieldsContainer .objectFields"),aH=[],az=aJ.length,aC=aM?aM.split(":")[0]:"",aP,aD,aO,aF=L[aM],aA,aB,ay,aL;q(".fieldsContainer .fieldsContent").scrollTop(0);if(aR&&aE){aB=aE+"."+aK;aN.append('<span class="pathToJunctionParent" data-pathToJP="'+au(aB)+'">from '+au(aB)+'</span><div class="drillBackRow"><span class="gbDrillBack" title="Click to go back" data-objectDotFk="'+au(aR)+'"></span>back to <span class="junctionParent">'+au(aE)+"</span></div>")}for(aL=0;aL<az;aL++){aP=aJ[aL];aO=i(aP.parentName,aP.name,aP.foreignKeyRelName);ay=(q.inArray(aO,M)>-1);if(q.inArray(aO,aF)==-1||ay){aA=f(aP);aD=au(aP.displayLabel);aH.push(ar(aO,aD,aP.name,aP.fieldDataType,aA,true,ay,false))}}var aI=(aH.length>0);an(aG,aI);if(aI){aG.html(aH.join(""))}q(".fieldsContent .objectFields .tooltip").tooltipster().focus(function(){q(this).tooltipster("show")}).blur(function(){q(this).tooltipster("hide")})}function h(aC,aD){var aA=GBCRUDSettings.getIsDenormalizedViewObject(aC),ay,aE=aC.split(":")[0],aB,az;if(aA){ay=q(".selectedFieldsContainer .selectedFieldsContent").find('div[id="'+parentObjectName+'"]')}else{ay=q(".selectedFieldsContainer .selectedFieldsContent").find('div[id="'+aC+'"]')}if(!aD){aD=aw[aC.split(":")[0]]}ay.find(".topSection .icon-ellipses").after(t(aE,aD,aC));ay.find(".linkObjectContainer .tooltip").tooltipster().focus(function(){q(this).tooltipster("show")}).blur(function(){q(this).tooltipster("hide")});aB=q(ay).find(".relWidget .child .relOptions");u(aB,aC,aD,aA);az=q(ay).find(".relWidget .parent .relOptions");u(az,parentObjectName,parentObjectLabel,aA);q(ay).find(".relWidget").fadeIn(500)}function f(aE){var aF=false,aA=false,aD=false,aG=false,aB=false,az=false,aC=false,ay;aF=(aE.foreignKeyRelName&&aE.foreignKeyRelName.indexOf("unrelated")==-1);aA=aE.fieldDataType.toUpperCase()==p;aD=(aE.referenceToObjects&&aE.referenceSize==1);aG=(aE.name==ah);az=(aE.parentName==aq||aE.parentName==s);ay=((aE.referenceToObjects&&aE.referenceToObjects.length>0)?aE.referenceToObjects[0]:null);aC=(aE.parentName==o[ay]);if(aF&&aA&&aD&&!aG&&!az&&ay!=T&&ay!=x&&ay!=b&&ay!=ax&&ay!=X&&ay!=U&&ay!=A&&!aC){aB=aE.parentName==aE.referenceToObjects[0];if(!aB){return aE.referenceToObjects[0]}}return null}function ar(aX,aG,aI,aJ,aC,aK,aA,aO,aV){var aM,aU="",aS=q(".showHideApiLink").hasClass("shown"),aL="",aW=["objField","cf"],aR;if(aK){if(!aA){aM='<span class="gbAddField" title="'+lang.addField+'" tabindex="0" role="button"></span>'}else{aM='<span class="gbAddFieldDisabled" title="This field is already added" tabindex="0" role="button"></span>'}if(objectCrossRefEnabled==true&&aC){var ay=aX.split(":"),aF=ay[0],aB=ay[1],aP=ay[2],aY=W(aF,aP);if(aB!=aP){var aE=aw[aC]||aC;aM+='<span class="gbDrillUp" title="'+lang.drillUpIconTxt+'" data-objectDotFk="'+aC+":unrelated-"+aI+"-"+aF+'" data-junctionObjectDotFk="'+aY+'" ></span>'}}}else{var aD,ay=aX.split(":"),aH=false,aT="",az="lbl",aQ="qf",aN="tah";aM='<span class="gbRemoveField" tabindex="0" role="button"></span>';if(ay.length==3){aD=ay[0]+":"+ay[1]}else{aD=aX}if(m[aD]){aH=true}else{if(d[aD]&&(d[aD][az]||d[aD][aQ]||d[aD][aN])){aH=true}}if(aH){aT=" on"}aU='<span class="icon-ellipses'+aT+'" title="'+lang.configureGwFieldProps+" - "+aG+'"></span>'}if(aC){aL=' data-referenceToObjectName="'+aC+'"'}if(aO){aW.push("dvc");aG=aV+"."+aG}if(aX=="OpportunityLineItemSchedule:OpportunityLineItem.OpportunityId:unrelated"){aR=true}return'<div class="'+aW.join(" ")+'" id="'+aX.replace(/:/g,"")+'" data-odf="'+aX+'" data-fdt="'+aJ+'"'+aL+">"+aM+'<span class="fieldLabel">'+aG+"</span>"+(aR?'<span class="gbInfoIcon tooltip" tabindex="0" title="This field is used exclusively to create a relationship. It will not show on the grid."></span>':"")+'<span class="fieldApiName'+(aS?" hidden":"")+'">'+aI+"</span>"+aU+"</div>"}function au(az){if(az){var ay=az.replace(/&/g,"&amp;");ay=ay.replace(/'/g,"&#39;");ay=ay.replace(/"/g,"&#34;");ay=ay.replace(/</g,"&lt;");ay=ay.replace(/>/g,"&gt;");return ay}return az}function aa(aK,aP){var aG=q(aK).parent(".objField"),aS=aG.attr("data-odf"),aA=aG.children(".fieldLabel").text().trim(),aL=aG.attr("data-fdt"),aD=aG.attr("data-referenceToObjectName"),az=aS.split(":"),aI=az.length,aH=az[0],aC=az[1],aN=(aI==3?az[2]:null),aR=W(aH,aN),aJ=aG.parents(".fieldsContent").find(".selectedObject"),aF=aJ.find(".selectedObjectLabel").text().trim(),aO=(aI==2),aM=aG.hasClass("dvc"),aE=aJ.find(".gbDrillBack"),aT=(aE&&aE.length>0?aE.attr("data-objectdotfk"):null),aB=(aT?aT.split(":")[1]:null),ay=(aI==3&&az[2].indexOf("unrelated")>-1&&az[2].indexOf("-")==-1);if(aM&&!aB){aB=aG.parents(".selectedFieldsContent .selectedObjectSection").attr("data-parentObjectFkName")}if(!aF){aF=aw[aH]}if(aP){aj(aG,aR,aS,aA,aC,aL,aD,aH,aF,aO,ay,aB)}else{var aQ=ak(aG,aR,aS,aA,aC,aL,aD,aO,ay);if(!aQ){return false}}GBChartsConfig.populateDropdowns();GBColorCoding.populateDropdowns();GBSearch.refreshFieldSearch();return true}function aj(a7,aU,aD,aE,aN,bb,a3,a8,aX,aF,aO,a6){var aH=au(aX),aY=L[aU],a4=q(".selectedFieldsContainer .selectedFieldsContent"),a2,az="",aV,aQ=at(aN,aD),aW=(GBCRUDSettings.getIsDenormalizedViewObject(aU)),aT=GBFieldProps.getAdminFieldProperties(),a1=GBFieldProps.getRowIdStrFromNames(a8,aN),aG=(aT[a1]?aT[a1]["dcf"]:false),a0;if(aW){a2=a4.find('div[id="'+parentObjectName+'"]')}else{a2=a4.find('div[id="'+aU+'"]')}if(!aY){aY=[]}if(aY.indexOf(aD)==-1){aY.push(aD)}L[aU]=aY;if(a3&&!aQ){M.push(aD)}if(a2.length>0){}else{if(aF){a4.prepend("<div id="+aU+' class="selectedObjectSection parent"><div class="topSection"><span class="objectAndApiNameContainer"><span class="objectLabel">'+aH+'</span><span class="relName"> Parent</span></span>'+B(aH)+'</div><div class="primaryFieldsSection"></div></div>');a2=a4.find('div[id="'+aU+'"]');if(C[aU]){a2.find(".topSection .icon-ellipses").addClass("on")}if(isGBUnlimited){GBDataCardSettings.init(a2)}}else{if(!aO){var aM=q('.objectsContainer .objectsContent .relatedChildObjects .objName[data-objectdotfk="'+aU+'"]');aV=aM.find(".relName").text()}if(a6){az='data-parentObjectFkName="'+a6+'"';if(a7){if(a7.hasClass("dvc")){aV=a7.parents(".selectedFieldsContent .selectedObjectSection").attr("data-pathToJP")}else{aV=a7.parents(".fieldsContent").find(".selectedObject .pathToJunctionParent").attr("data-pathToJP")}}if(!aV){var aJ=aU.replace(":unrelated-","-");aV=objectNameToPathToJunction[aJ]}}var aP=q(".objectsContainer .objectsContent .allObjects .objName .relName").filter(function(){return q(this).text().trim()==a8}).parent(".objName").attr("data-index");aP=(aP*1);var a9=false,aR,ay=q(".selectedFieldsContainer .selectedFieldsContent .selectedObjectSection");var aA="<div id="+aU+' class="selectedObjectSection" '+az+' data-index="'+aP+'"><div class="topSection"><span class="objectAndApiNameContainer"><span class="objectLabel">'+aH+'</span><span class="relName"> '+(aO?"Unrelated":au(aV))+"</span></span>"+B(aH)+'</div><div class="primaryFieldsSection"></div></div>';if(ay.length==1&&q(ay[0]).hasClass("parent")){aR=q(ay[0])}else{a9=true;for(var ba=0;ba<ay.length;ba++){var aS=q(ay[ba]);if((aS.attr("data-index")*1)>aP){aR=q(ay[ba-1]);break}}}if(aR){aR.after(aA)}else{a4.append(aA)}a2=a4.find('div[id="'+aU+'"]');var aI=false;var aK=C[aU];if(aK&&Object.keys(aK).length==1&&aK.Flat_View_Type=="none"){aI=true}if((C[aU]&&!aI)||(E&&C[aU]==undefined)){a2.find(".topSection .icon-ellipses").addClass("on")}if(a7&&a9){a4.animate({scrollTop:a2.offset().top-a4.offset().top+a4.scrollTop()})}if(aO&&E){a2.find(".topSection .icon-ellipses").after(t(a8,aX,aU));a2.find(".linkObjectContainer .tooltip").tooltipster().focus(function(){q(this).tooltipster("show")}).blur(function(){q(this).tooltipster("hide")});a2.find(".relWidget").fadeIn(500)}if(isGBUnlimited){GBDataCardSettings.init(a2)}}}if(aW&&a6){if(!a2.attr("data-parentObjectFkName")){a2.attr("data-parentObjectFkName",a6)}}q(".selectedObjectSection").sortable({items:"div.objField"});var aZ=a2.find(".dataCardSection"),aB=(a2.find(".objField").length>=GBDataCardSettings.getMaxPrimaryFieldsNumber()),aL="";if(isGBUnlimited){if((aB&&aZ.is(":visible"))||aG){aL=".dataCardSection";if(a7){GBDataCardSettings.updateAdminFieldProperty(a7.attr("id"),true)}}else{aL=".primaryFieldsSection";if(a7){GBDataCardSettings.updateAdminFieldProperty(a7.attr("id"),false)}}if(aG&&!aZ.is(":visible")){a2.find(".primaryFieldsLabel, .dataCardFieldsLabel, .dataCardSection").each(function(){q(this).css("display","block")});a2.find(".icon-wrap").addClass("on")}}else{aL=".primaryFieldsSection"}a0=ar(aD,au(aE),aN,bb,a3,false,false,aW,aH);a2.find(aL).append(a0);if((aL==".dataCardSection")&&a2.find(".dataCardEmptyDiv").is(":visible")){GBDataCardSettings.hidePlaceHolder(a2)}if(E){if(aO){e(a2,aU,aX)}if(aF){k()}}else{var a5=a4.find(String.format('div[id="{0}"]',parentObjectName));if(aW&&!a5.attr("data-codf")){a5.attr("data-codf",aU)}}if(a7){var aC=(a7.siblings().length>0);an(a7.parents(".objectFields"),aC);if(a3&&!aQ){N(a7)}else{a7.remove()}}if(q(a0).find(".tooltip").length>0){q(".selectedObjectSection .objField .tooltip").tooltipster().focus(function(){q(this).tooltipster("show")}).blur(function(){q(this).tooltipster("hide")})}}function B(ay){return'<span class="icon-ellipses" title="'+lang.configureObjectSettings+" - "+ay+'"></span>'}function at(aC,aB){var aA=aB.split(":"),ay=(aA.length==3?aA[2]:""),az=(aC==ay);return az}function N(ay){ay.find(".gbAddField").addClass("gbAddFieldDisabled").removeClass("gbAddField").attr("title","This field is already added")}function k(){var ay=q(".selectedFieldsContainer .selectedFieldsContent"),az;q(ay.find(".selectedObjectSection .relWidget")).each(function(){az=q(this).closest(".selectedObjectSection");e(az,parentObjectName,parentObjectLabel)})}function t(aB,aA,ay){var az='<div class="relWidget cf" style="display:none"><div class="linkObjectContainer"><div class="linkInstr">'+lang.linkObjectWidgetTxt+" <b>"+au(parentObjectLabel)+"</b> to <b> "+au(aA)+'</b>:<span class="gbInfoIcon tooltip" tabindex="0" title="Select the fields to define the custom relationship between this object and the parent object (this is the equivalent of a Left Join in SQL, where the columns being joined are those selected here, and the left table is the parent object). The fields shown in the picklists are those that have been selected for the grid. Note, if the fields selected do not have unique values this may result in duplicated rows when you launch your grid."></span></div><div class="objSection parent"><div class="relOptions" id="unrelated'+parentObjectName+'" data-objectDotFk="'+parentObjectName+'">'+J(parentObjectName,parentObjectLabel)+'</div></div><div class="eq">&nbsp;<b> maps to </b>&nbsp;</div><div class="objSection child"><div class="relOptions" id="unrelated'+aB+'" data-objectDotFk="'+ay+'">'+J(ay,aA)+"</div></div></div></div>";return az}function u(aC,aE,aF,ay){var aB=aE.split(":")[0],aC=q(aC),aG=aE.indexOf(":")>-1,aA,az;if(aB==parentObjectName){if(ay){aB=aC.parents(".selectedObjectSection").attr("data-codf").split(":")[0]}else{aB=aC.parents(".selectedObjectSection").attr("id").split(":")[0]}}for(var aD in n){if(aD==aB){aA=n[aD];az=(aG?aA.unrelatedField:aA.parentField);aC.children("select").val(az)}}}function J(aE,aH){var aB=L[aE],aF=[],aJ=au(aH),az=['<select class="unrelatedSelect"><option value="" >--Select '+aJ+" Field--</option>"],ay=(aB?aB.length:0),aI,aD,aG,aA;for(aA=0;aA<ay;aA++){aI=aB[aA];aD=ae[aI];aF.push(aD)}function aC(aL,aK){if(aL.displayLabel<aK.displayLabel){return -1}if(aL.displayLabel>aK.displayLabel){return 1}return 0}aF.sort(aC);for(aA=0;aA<ay;aA++){aD=aF[aA];if(aD!=undefined&&q.inArray(aD.fieldDataType,ab)>-1){if(aD.fieldDataType.toUpperCase()==p){aG="ID "+p}else{aG=aD.fieldDataType}az.push('<option data-dt="'+aD.fieldDataType+'" value="'+aD.name+'">'+aJ+"."+au(aD.displayLabel)+" ("+aG+")</option>")}}az.push("</select>");return az.join("")}function e(aD,aA,aE){var aC=aD.find('div.linkObjectContainer div[data-objectDotFk="'+aA+'"]'),aB,ay,az=false;if(aC.length>0){aB=aC.find("select").val();ay=J(aA,aE);aC.html(ay);q(aC.find("select option")).each(function(){if(q(this).val()==aB){az=true;return false}});if(az){aC.find("select").val(aB)}else{aC.find("select").val("")}}}function ak(aE,aR,aT,az,aA,aM,aB,aO,ay){var aJ=L[aR],aH=aJ.length,aP=M.length,aF=aE.attr("id"),aG,aD=at(aA,aT),aK=aE.hasClass("dvc"),aQ=q('.selectedFieldsContent div[id="'+parentObjectName+'"]'),aL,aN;if(aK){var aC=aw[aT.split(":")[0]];az=az.substring(aC.length+1)}else{if(aH===1){var aI=aQ.attr("data-codf");if(aI){alert("The parent object has a Flat View child object enabled. Please remove Flat View from the child object before removing the last parent field.");return false}}}GBFieldProps.deletePropertiesForUnselectedField(aF);for(aN=0;aN<aH;aN++){if(aJ[aN]==aT){aJ.splice(aN,1);break}}for(aN=0;aN<aP;aN++){if(M[aN]==aT){M.splice(aN,1);break}}L[aR]=aJ;if(av==aR){if(aB&&!aD){ad(aT)}else{var aS=q(".fieldsContainer .objectFields");an(aS,true);aL=ar(aT,au(az),aA,aM,aB,true,false,false);aS.append(aL);if(q(aL).find(".tooltip").length>0){q(".fieldsContent .objectFields .tooltip").tooltipster().focus(function(){q(this).tooltipster("show")}).blur(function(){q(this).tooltipster("hide")})}}}if(aH===1){if(aK){GBCRUDSettings.clearSelectedDenormalizedViewObject();aQ.removeAttr("data-codf");aE.remove()}else{aE.closest(".selectedObjectSection").remove()}GBCRUDSettings.removeObjectFromCrudSettingsJsonCopy(aR)}else{if(ay){aG=aR.split(":")[0];e(aE.closest(".selectedObjectSection"),aR,aw[aG])}if(aO){k()}if(aE.closest(".dataCardSection").find(".objField").length==1){GBDataCardSettings.showPlaceHolder(aE.closest(".selectedObjectSection"))}aE.remove()}return true}function ad(ay){var az=q('.fieldsContent .objField[data-odf="'+ay+'"]');az.find(".gbAddFieldDisabled").addClass("gbAddField").removeClass("gbAddFieldDisabled").attr("title",lang.addField)}function P(){q(".objectsContainer .parentObjectName .objName").trigger("click")}function R(){G=q(".selectedObjectSection .primaryFieldsSection div").length+q(".dataCardSection div").length;q(".selectedFieldsSectionHeading .headingText").after("<span class='selectedFieldsCounter'> ("+G+")</span>")}function af(ay){q(".selectedFieldsCounter").html("<span class='selectedFieldsCounter'> ("+ay+")</span>")}function ap(){var ay;q(".relWidget .relOptions").each(function(){if(!q(this).find("select option:selected").val()){ay=lang.relationshipsRequired;return false}});return ay}function z(){var aB,az,ay,aA;q(".relWidget .child .relOptions").each(function(){az=q(this).find("select option:selected").attr("data-dt");ay=q(this).parents(".relWidget").find(".parent .relOptions select option:selected").attr("data-dt");aA=O[az];if(q.inArray(ay,aA)==-1){aB="The fields selected in the picklists to map objects must have compatible data types.";return false}});return aB}function an(ay,az){if(az&&ay.hasClass("noData")){ay.removeClass("noData").html("")}else{if(!az){ay.addClass("noData").html("All fields have been selected.")}}}function F(){for(var ay in L){g.push(ay)}}return{init:Y,constructObjectDotField:i,htmlEscape:au,getFieldObjectProperties:v,populateObjectDotFieldsForSave:am,updateRelationshipsJSON:j,validateUnrelatedRelationships:ap,validateRelationshipFieldDataTypes:z,objectNameToLabelMap:aw,toggleField:aa,getSelectedObjectsOnLoad:Q}})(window,document,jq);var GBFieldProps=(function(e,n,o){var a=o("#gbFieldPropPopup"),l={},p={},g={};t();function t(){l=JSON.parse(o("[id*='fieldPropsJson']").val());p=JSON.parse(o("[id*='adminFieldPropsJson']").val());h();s();v()}function h(){o(".selectedFieldsContent").on("click","div.objField span.icon-ellipses",function(){o("label.popupLabel span.gbInfoIcon.tooltip").tooltipster().focus(function(){o(this).tooltipster("show")}).blur(function(){o(this).tooltipster("hide")});var y=o(this).closest("div.objField"),x=y.attr("id"),A=y.attr("data-odf").split(":")[0],z=y.find(".fieldApiName").text();GBMixpanel.track("GW2 View Properties",{Level:"Field"});if(!g[c(x)]){u(x,false);getNativeFieldProperties(A,z,x)}else{u(x,true)}})}function s(){a.find("input:checkbox").click(function(){var y=o(this),x=y.attr("id"),z=a.find("#readOnlyChk");rqrdEl=a.find("#rqrdChk"),isReadOnly=z.is(":checked"),isRqrd=rqrdEl.is(":checked");if(!isRqrd&&!isReadOnly){return}else{if(x=="readOnlyChk"&&isReadOnly){if(!rqrdEl.prop("disabled")){rqrdEl.prop("checked",false)}}else{if(x=="rqrdChk"&&isRqrd){if(!z.prop("disabled")){z.prop("checked",false)}}}}});o("#readOnlyRd").click(function(){o("#readOnlyChk").click()});o("#rqrdRd").click(function(){o("#rqrdChk").click()})}function v(){a.find(".cancelPopupBtn").click(function(){b()});a.find(".okPopupBtn").click(function(){w()})}function w(){var J=a.find("#liId").val(),y=c(J),E=a.find("#hideObjLabel").is(":checked")&&a.find("#hideObjLabel").parent().is(":visible"),z=a.find("#rqrdChk").is(":checked"),B=a.find("#readOnlyChk").is(":checked"),x=a.find("#fieldLabelInput").val(),D=a.find("#colWidthInput").val(),H=a.find("#txtAreaHeightInput").val(),F=a.find("#summaryTypeSelect").val(),A=a.find("#qFilterChk").is(":checked"),I=g[y];D=(D==null||isNaN(D)?"":D);var G=parseFloat(D);H=(H==null||isNaN(H)?"":H);var C=parseFloat(H);if(!isNaN(G)&&G%1!=0){D=Math.round(G)+""}if(!isNaN(C)&&C%1!=0){H=Math.round(C)+""}if(D!=""&&G<=0){D=""}if(H!=""&&C<=0){H=""}if(F=="0"||F==0){F=""}l[y]={rq:z,ro:B,cw:D,st:F,hl:E};if(!p[y]){p[y]={}}if(x!=""){p[y]["lbl"]=x}else{p[y]["lbl"]=""}p[y]["qf"]=A;if(A==true){if(p[y]["qfField"]!=null&&p[y]["qfField"]!=""){p[y]["qfField"]+=";"+J}else{p[y]["qfField"]=J}}if(C!=""){p[y]["tah"]=H}b();o(".selectedFieldsContent").find('.objField[id="'+J+'"] .icon-ellipses').addClass("on")}function m(x){var y=c(x);delete l[y];delete p[y]}function q(A,z,x){var y=i(A,z);g[y]=x;if(g[y]&&(g[y].dataType=="BOOLEAN")){g[y].rq=false}}function d(){o("[id*='fieldPropsJson']").val(JSON.stringify(l));o("[id*='adminFieldPropsJson']").val(JSON.stringify(p))}function k(y){for(var z in l){var x=l[z];if(x[y]){x[y]=false}}}function u(T,N){var G=o(".selectedFieldsContent .objField#"+T),U=G.hasClass("dvc");var Q=a.find("#fpContent"),R=a.find(".icon-spinner");a.find("#liId").val(T);if(N){Q.visible();R.hide();var H=c(T),z=g[H],x=l[H],A=p[H],I=z?z.filterable:false,M=z?z.dataType:"";var y=G.find("span.fieldLabel").text(),F=G.closest("div.selectedObjectSection").find("span.objectLabel").text(),E=F,V=E.indexOf(" ("),O=y;var L=a.find("#colWidthInput"),C=L.closest(".popupRow"),B=a.find("#txtAreaHeightInput"),K=B.closest(".popupRow"),J=a.find("#summaryTypeSelect"),P=J.closest(".summaryTypeSelectRow"),D=a.find("#hideObjLabel").closest(".popupRow"),S=G.parents(".dataCardSection").length>0;if(V>-1){E=E.substring(0,V)}if(y.indexOf(E)==-1&&!U){O=E+" "+y}a.find("#propFieldLabel").text(O);a.find("input:checkbox").prop("checked",false);a.find("input:checkbox:not(.qfCheck)").prop("disabled",false);a.find("input[type=checkbox]:not(.qfCheck)").removeClass("none");a.find("input[type=radio]").addClass("none");if(M=="BOOLEAN"){a.find("#rqrdChk").prop("disabled",true)}a.find("#fieldLabelInput").val("");L.val("");B.val("");J.val("0");if(z&&(z.ro||z.rq)){if(z.ro){a.find("#readOnlyChk").prop("checked",true);a.find("input.rorqrd:checkbox").prop("disabled",true)}else{if(z.rq){a.find("input[type=radio]").removeClass("none");a.find("input[type=checkbox]:not(.qfCheck,.hideObjLbl)").addClass("none");o("#rqrdRd").click();if(x&&x.ro){o("#readOnlyRd").click()}}}}else{if(x){if(x.ro){a.find("#readOnlyChk").prop("checked",true)}else{if(x.rq){a.find("#rqrdChk").prop("checked",true)}}}}if(x){if(x.hl){a.find("#hideObjLabel").prop("checked",true)}}if(x&&x.cw&&(x.cw*1>0)&&!S){L.val(x.cw)}L.prop("disabled",S);if(S){C.css("color","#cdcdcd").prop("title","This feature is not available for Data Card fields.")}else{C.css("color","").prop("title","")}if(A&&A.lbl){a.find("#fieldLabelInput").val(A.lbl)}if(M!=="TEXTAREA"&&I){a.find("#qFilterChk").removeAttr("disabled");if(A&&A.qf){a.find("#qFilterChk").prop("checked",true)}}else{a.find("#qFilterChk").prop("disabled",true)}if(M=="PICKLIST"||M=="STRING"||M=="CURRENCY"||M=="PERCENT"||M=="INTEGER"||M=="DOUBLE"){P.show();if(x&&x.st&&!S){J.val(x.st)}J.prop("disabled",S);if(S){P.css("color","#cdcdcd").prop("title","This feature is not available for Data Card fields.")}else{P.css("color","").prop("title","")}}else{P.hide()}if(M==="TEXTAREA"){K.show();if(A&&A.tah&&(A.tah>0)){B.val(A.tah)}}else{K.hide()}if(!U){D.hide()}else{D.show()}}else{Q.invisible();R.show()}o("#gbOverlay").show();a.center();a.show()}function b(){a.hide();o("#gbOverlay").hide()}function j(x){return i(o("#"+x+" .parentName").text(),o("#"+x+" .fieldName").text())}function c(y){if(y.indexOf(".")>0){y=y.replace(".","\\.")}var x=o("#"+y),A=x.attr("data-odf").split(":")[0],z=x.find(".fieldApiName").text();return i(A,z)}function i(y,x){return y+":"+x}function f(){return p}function r(x){p=x}return{showPropsWidget:u,addNativeFieldProperties:q,updatePropsJSONForSave:d,deletePropertiesForUnselectedField:m,hidePropsWidget:b,getRowIdStringUnrelated:c,getRowIdStrFromNames:i,getAdminFieldProperties:f,setAdminFieldProperties:r,resetPropertyForSave:k}})(window,document,jq);var GBColorCoding=(function(h,n,q){var k={},t={},a=JSON.parse(q('[id*="colorCodingRulesJson"]').val()),f,e={};function r(){k=s();for(var y=0;y<a.length;y++){q("#colorCodingTable #rules").after('<tr id="rule-'+a[y].id+'" class="gbForm colorCodingRules"><td>'+GBFields.htmlEscape(a[y].name)+"</td></tr>")}q("#colorCodingTable").on("click","tr.colorCodingRules",function(){p(q(this))});q("#colorCodingTable .formattingOption").click(function(){q(this).toggleClass("selected")});q("#colorCodingTable").on("blur","#colorCodeNameInput",function(){var A=q("#rule-"+t.id+" td");A.text(q(this).val()).html()});q("#colorCodingTable .colorPickerRow div").click(function(){if(q(this).hasClass("selected")){q(this).closest(".colorPickerDiv").find(".colorPickerRow div").removeClass("selected")}else{q(this).closest(".colorPickerDiv").find(".colorPickerRow div").removeClass("selected");q(this).addClass("selected")}});var z="<span>Format a field based on a condition.<ol><li>Select a controlling field and a condition.</li><li>Specify if you want to apply the colors and styles to the same field, another field, or the entire row.</li><li>Select the formatting options: background color, text color and text formatting.</li></ol>A few popular examples: <ul><li>If the Opportunity Amount is greater than 1000 set the background color to green.</li><li>If the Account Rating equals Hot, set the background color to red for the entire row.</li><li>If the Task Due Date is less than a specific date, color the Task Name blue.</li></ul></span>";q(".colorCodingContainer .instr .tooltip").tooltipster({content:q(z),});var x='<span>Enter a date using the date widget, or type in a relative date.<br>Supported relative dates include:<div class="dateTooltipTextRow"> <div class="dateTooltipTextColumn"><ul><li>THIS_YEAR</li><li>LAST_YEAR</li><li>NEXT_YEAR</li></ul></div> <div class="dateTooltipTextColumn"><ul><li>THIS_QUARTER</li><li>LAST_QUARTER</li><li>NEXT_QUARTER</li></ul></div> <div class="dateTooltipTextColumn"><ul><li>THIS_MONTH</li><li>LAST_MONTH</li><li>NEXT_MONTH</li></ul></div> <div class="dateTooltipTextColumn"><ul><li>THIS_WEEK</li><li>LAST_WEEK</li><li>NEXT_WEEK</li></ul></div> <div class="dateTooltipTextColumn"><ul><li>TODAY</li><li>YESTERDAY</li><li>TOMORROW</li></ul></div></div></span>';q(".colorCodingContainer .dateConditionalFormattingTooltip").tooltipster({content:q(x),});q("#colorCodingTable #colorCodeGoverningField").on("change",function(){var A=k[q(this).val()]||{};w(A.dataType);if(A.dataType=="PICKLIST"){i(q(this).val())}if(q("#colorCodingTable #colorCodeColoredField").val()=="0"&&q("#colorCodingTable #colorWholeRowChk").prop("checked")==false){q("#colorCodingTable #colorCodeColoredField").val(q(this).val())}l()});q("#addRuleBtn").on("click",c);q("#deleteRuleBtn").on("click",b);if(a.length==0){c();w("STRING")}p(q("#colorCodingTable #rules").next())}function w(x){if(x=="PICKLIST"){q("#colorCodingTable .picklistColorCoding").show();q("#colorCodingTable .inputColorCoding").hide();q("#colorCodingTable .checkboxColorCoding").hide()}else{if(x=="BOOLEAN"){q("#colorCodingTable .picklistColorCoding").hide();q("#colorCodingTable .inputColorCoding").hide();q("#colorCodingTable .checkboxColorCoding").show()}else{q("#colorCodingTable .picklistColorCoding").hide();q("#colorCodingTable .inputColorCoding").show();q("#colorCodingTable .checkboxColorCoding").hide();if(x=="STRING"||x=="TEXTAREA"||x=="PHONE"||x=="EMAIL"){q("#colorCodingTable #stringOperatorSelect").show();q("#colorCodingTable #numericOperatorSelect").hide()}else{q("#colorCodingTable #stringOperatorSelect").hide();q("#colorCodingTable #numericOperatorSelect").show()}if(x=="DATE"||x=="DATETIME"){disableDatePicker(q("#colorCodingTable #colorCodeValueInput"));enableDatePicker(x,q("#colorCodingTable #colorCodeValueInput"),false);q(".colorCodingContainer .dateConditionalFormattingTooltip").addClass("show")}else{disableDatePicker(q("#colorCodingTable #colorCodeValueInput"));q(".colorCodingContainer .dateConditionalFormattingTooltip").removeClass("show")}}}}function i(x){t.operator="=";if(e[x]==undefined){q("#colorCodingTable .picklistColorCoding").addClass("picklistOptionsLoading");v(x)}else{m(e[x])}}function s(){var x={};q(".selectedFieldsContent .objField").each(function(){var y=GBFields.getFieldObjectProperties(this),z=GBFields.constructObjectDotField(y.objectName,y.fieldName,y.objectFk);x[z]=y});return x}function v(A){var x=A.split(":")[0],z=A.split(":")[1];if(f){f.abort()}var y={reqtype:"filterVals",don:x,dfn:z};f=q.ajax({type:"POST",url:lookupAjaxResponderPageURL,data:y,dataType:"json",success:function(B){f=null;if(!B){return}e[A]=B.results;m(B.results)}})}function m(z){var x=['<option value="0">--Select--</option>'];q("#colorCodingTable .picklistColorCoding").removeClass("picklistOptionsLoading");for(var y=0;y<z.length;y++){x.push('<option value="'+GBFields.htmlEscape(z[y])+'">'+GBFields.htmlEscape(z[y])+"</option>")}q("#colorCodingTable #colorCodeValueSelect").empty().append(x.join(""));if(t.value&&z.indexOf(t.value)!=-1){q("#colorCodingTable #colorCodeValueSelect").val(t.value)}else{q("#colorCodingTable #colorCodeValueSelect").val("0")}}function p(z){var A={},y=z.attr("id");if(z.length==0||a.length==0){o();q("#colorCodingTable #noDataText").show();q("#colorCodingTable .hideIfNoData").hide();return}else{q("#colorCodingTable #noDataText").hide();q("#colorCodingTable .hideIfNoData").show()}u(t.id);o();q("#colorCodingTable .colorCodingRules").removeClass("highlightRow");z.addClass("highlightRow");y=y.replace("rule-","");for(var x=0;x<a.length;x++){if(a[x].id==y){t=a[x];break}}q("#colorCodingTable #colorCodeNameInput").val(t.name);q("#colorCodingTable #colorCodeGoverningField").val(t.governingField);q("#colorCodingTable #colorCodingBold").toggleClass("selected",t.isBold);q("#colorCodingTable #colorCodingItalic").toggleClass("selected",t.isItalic);q("#colorCodingTable #colorCodingUnderline").toggleClass("selected",t.isUnderline);q("#colorCodingTable #colorCodeColoredField").val(t.coloredField);q("#colorCodingTable #colorWholeRowChk").prop("checked",t.isColorRow).change();q("#colorCodingTable #colorCodeColorSelect .color-"+t.color).addClass("selected");q("#colorCodingTable #colorCodeTextColorSelect .color-"+t.textColor).addClass("selected");A=k[t.governingField];if(A){w(A.dataType)}if(A&&A.dataType=="PICKLIST"){i(t.governingField);q("#colorCodingTable #colorCodeValueSelect").val(t.value)}else{if(A&&A.dataType=="BOOLEAN"){q("#colorCodingTable #colorCodeValueCheckbox").prop("checked",t.value)}else{if(A&&A.dataType=="STRING"||A&&A.dataType=="TEXTAREA"||A&&A.dataType=="EMAIL"||A&&A.dataType=="PHONE"){q("#colorCodingTable #stringOperatorSelect").val(t.operator)}else{q("#colorCodingTable #numericOperatorSelect").val(t.operator)}q("#colorCodingTable #colorCodeValueInput").val(t.value)}}l()}function l(){k=s();var z=['<option value="0">--Select Field--</option>'],y=['<option value="0">--Select Field--</option>'],D="",x=q("#colorCodingTable #colorCodeColoredField").val()||t.coloredField||0,A=q("#colorCodingTable #colorCodeGoverningField").val()||t.governingField||0,B=q("#colorCodingTable #colorCodeColoredField").empty(),E=q("#colorCodingTable #colorCodeGoverningField").empty(),G=false,F=true;for(var C in k){dataType=k[C].dataType;labelName=k[C].labelName;objectDotFieldParts=C.split(":");parentApiName=objectDotFieldParts[0];objectLabel=GBFields.objectNameToLabelMap[parentApiName];isCurrentFieldOnTheParent=objectDotFieldParts.length==2;D='<option value="'+C+'">'+GBFields.htmlEscape(objectLabel)+"."+GBFields.htmlEscape(labelName)+" ("+dataType+")</option>";if(dataType=="PICKLIST"||dataType=="DATE"||dataType=="DATETIME"||dataType=="CURRENCY"||dataType=="PERCENT"||dataType=="INTEGER"||dataType=="DOUBLE"||dataType=="STRING"||dataType=="TEXTAREA"||dataType=="BOOLEAN"||dataType=="PHONE"||dataType=="EMAIL"){z.push(D);if(C==A){F=true}}if(A==0||A.split(":")[0]==parentApiName){y.push(D);if(C==x){G=true}}}E.append(z.join(""));B.append(y.join(""));if(F){E.val(A)}else{E.val(0)}if(G){B.val(x)}else{if(x=="0"&&q("#colorCodingTable #colorWholeRowChk").prop("checked")==false){B.val(A)}else{B.val(0)}}}function c(){var x=new Date().getTime();u(t.id);t={id:x};a.push({id:x});q("#colorCodingTable .colorCodingRules").removeClass("highlightRow");q("#colorCodingTable #rules").after('<tr id="rule-'+x+'" class="gbForm colorCodingRules highlightRow"><td class="gridProfile-title">New Rule</td></tr>');o();p(q("#colorCodingTable #rules").next())}function o(){q("#colorCodingTable #colorCodeNameInput").val("");q("#colorCodingTable #colorCodeGoverningField").val(0);q("#colorCodingTable #colorCodeColorSelect .colorPickerRow div").removeClass("selected");q("#colorCodingTable #colorCodeTextColorSelect .colorPickerRow div").removeClass("selected");q("#colorCodingTable #colorCodingBold").removeClass("selected");q("#colorCodingTable #colorCodingItalic").removeClass("selected");q("#colorCodingTable #colorCodingUnderline").removeClass("selected");q("#colorCodingTable #colorCodeColoredField").val(0);q("#colorCodingTable #colorWholeRowChk").prop("checked",false).change();q("#colorCodingTable .colorCodeOperatorSelect").val("=");q("#colorCodingTable #colorCodeValueInput").val("");q("#colorCodingTable #colorCodeValueSelect").val(0);q("#colorCodingTable #colorCodeValueCheckbox").prop("checked",false)}function b(){if(!t.id){alert("Please select a rule to delete.");return}var x=confirm("Are you sure you want to delete this rule?");if(x){for(var y=0;y<a.length;y++){if(a[y].id==t.id){removeIndex=y;break}}a.splice(removeIndex,1);q("#colorCodingTable #rule-"+t.id).remove();p(q("#colorCodingTable #rules").next())}}function u(z){var y={};for(var x=0;x<a.length;x++){if(a[x].id==z){a[x].name=q("#colorCodingTable #colorCodeNameInput").val();a[x].governingField=q("#colorCodingTable #colorCodeGoverningField").val();a[x].color=q("#colorCodingTable #colorCodeColorSelect .selected").attr("data-colorId");a[x].textColor=q("#colorCodingTable #colorCodeTextColorSelect .selected").attr("data-colorId");a[x].isBold=q("#colorCodingTable #colorCodingBold").hasClass("selected");a[x].isItalic=q("#colorCodingTable #colorCodingItalic").hasClass("selected");a[x].isUnderline=q("#colorCodingTable #colorCodingUnderline").hasClass("selected");a[x].coloredField=q("#colorCodingTable #colorCodeColoredField").val();a[x].isColorRow=q("#colorCodingTable #colorWholeRowChk").prop("checked");y=k[a[x].governingField];if(y&&y.dataType=="PICKLIST"){a[x].value=q("#colorCodingTable #colorCodeValueSelect").val();if(a[x].value=="0"){a[x].value=""}}else{if(y&&y.dataType=="BOOLEAN"){a[x].value=q("#colorCodingTable #colorCodeValueCheckbox").prop("checked")}else{a[x].value=q("#colorCodingTable #colorCodeValueInput").val();a[x].operator=q("#colorCodingTable .colorCodeOperatorSelect:visible").val()}}}}}function d(){var y=[],z=false;u(t.id);if(a.length==1){if(a[0].name==""&&a[0].governingField==0&&a[0].coloredField==0){q('[id*="colorCodingRulesJson"]').val("[]");return y}}for(var x=0;x<a.length;x++){if(a[x].name==""&&!z){y.push("Please give a name to all the conditional formatting rules.");z=true;continue}if(a[x].governingField=="0"){y.push('Please select a field in the "'+GBFields.htmlEscape(a[x].name)+'" rule.')}else{if(k[a[x].governingField]==undefined){y.push('The field on the "'+GBFields.htmlEscape(a[x].name)+'" rule is not configured on the grid any more. Please re-add the field to the grid or select another field in the rule.')}}if(a[x].coloredField=="0"&&a[x].isColorRow==false){y.push('Please select a field to color or check the "color the whole row" checkbox in the "'+GBFields.htmlEscape(a[x].name)+'" rule.')}else{if(k[a[x].coloredField]==undefined&&a[x].isColorRow==false){y.push('The field to color on the "'+GBFields.htmlEscape(a[x].name)+'" rule is not configured on the grid any more. Please re-add the field to the grid or select another field in the rule or check the "color whole row" checkbox.')}}if(a[x].color==undefined&&a[x].textColor==undefined&&a[x].isBold==false&&a[x].isItalic==false&&a[x].isUnderline==false){y.push('Please select a background color or a text color or a formatting option in the "'+GBFields.htmlEscape(a[x].name)+'" rule.')}if(a[x].operator=="0"&&k[a[x].governingField]!=undefined&&k[a[x].governingField].dataType!="PICKLIST"){y.push('Please select a logical operator in the "'+GBFields.htmlEscape(a[x].name)+'" rule.')}}q('[id*="colorCodingRulesJson"]').val(JSON.stringify(a));return y}function j(y){var x=q("#colorCodingErrorMessage").position();q("#colorCodingErrorMessage .msgDetail").html(y);q("#colorCodingErrorMessage").show();q(h).scrollTop(x.top)}function g(){q("#colorCodingErrorMessage .msgDetail").html("");q("#colorCodingErrorMessage").hide()}return{init:r,populateDropdowns:l,addRule:c,updateColorsJSONForSave:d,showErrorMessage:j,hideErrorMessage:g}})(window,document,jq);function save(){if(saveAlreadyRun==true){GBFields.populateObjectDotFieldsForSave()}jq(objectDotFieldsHidden).val(objectDotFields.toString());return true}function selectedObject(a){this.objectName=a;this.fields=new Array()}function showWarningMessage(e,d,a){var b=jq("#vldWarning");var c=jq(e).position();b.find(".msgBody").html(d);b.css("top",(c.top*1+73));b.css("left",(c.left*1+585));b.show();a.stopPropagation();jq(window).scrollTop(c.top)}function setIsWebKit(){if((/AppleWebKit/).test(navigator.userAgent)){jq("div.gbwPage").addClass("webkit")}}function setFocusOnLoad(){}var JSObjectHelper=(function(b,a,d){function c(){if(!String.format){String.format=function(f){var e=Array.prototype.slice.call(arguments,1);return f.replace(/{(\d+)}/g,function(g,h){return typeof e[h]!="undefined"?e[h]:g})}}d.fn.center=function(e){return this.each(function(){var f=d(this);f.css({position:e?"absolute":"fixed",left:"50%",top:"50%",zIndex:"10000"}).css({marginLeft:"-"+(f.outerWidth()/2)+"px",marginTop:"-"+(f.outerHeight()/2)+"px"});if(e){f.css({marginTop:parseInt(f.css("marginTop"),10)+d(b).scrollTop(),marginLeft:parseInt(f.css("marginLeft"),10)+d(b).scrollLeft()})}})};d.fn.visible=function(){return this.css("visibility","visible")};d.fn.invisible=function(){return this.css("visibility","hidden")}}return{init:c}})(window,document,jq);var GBCRUDSettings=(function(k,q,s){var l=JSON.parse(s('[id*="crudSettingsJson"]').val()),w=s.extend(true,{},l),g=s.extend(true,{},l),b=s("#objectLevelCRUD"),h={CONCATENATED:"concatenated",DENORMALIZED:"denormalized"},r;function u(){t();z()}function o(){r=null}function n(C){if(!r){z()}return(r!=null&&C==r.name)}function v(){var D,C,G={},E=[],F=[];for(var H in w){D=w[H];C=H.split(":")[0];if(D.Flat_View_Type==h.DENORMALIZED){E.push(C)}if(D.Flat_View_Type==h.CONCATENATED){F.push(C)}}if(E.length>0){G.flatViewEnabledObjects=E.join(",")}if(F.length>0){G.editableRelatedColumnObjects=F.join(",")}return G}function z(){var C;for(var E in w){C=w[E];if(C.Flat_View_Type==h.DENORMALIZED){var D=s('.objectsContent .objName[data-objectdotfk="'+E+'"] .objectLabel').text();r={name:E,label:D}}}}function y(C){delete w[C]}function B(){var I=[];var E=[];var G=[];var F=GBFields.getSelectedObjectsOnLoad();var C;for(var H in w){I.push(H)}for(var D=0;D<selectedObjectsReadable.length;D++){C=selectedObjectsReadable[D];if(s.inArray(C,F)==-1){G.push(C)}}for(var D=0;D<G.length;D++){C=G[D];if(s.inArray(C,I)==-1){E.push(C)}}for(var D=0;D<E.length;D++){C=E[D];if(C.indexOf(":")>-1){w[C]={Flat_View_Type:h.CONCATENATED}}}s('[id*="crudSettingsJson"]').val(JSON.stringify(w))}function a(G,H,F,J){var K,D=b.find("#objectLevelCRUDBody");if(G&&H){D.find(".crudObjLabel").text(H).data("objDotNotation",G);K=w}else{G=D.find(".crudObjLabel").data("objDotNotation");K=w;if(G==parentObjectName){var I=s(String.format('.selectedFieldsContent div[id="{0}"]',parentObjectName));J=I.attr("data-codf")}}d(G,D,K);if(J){var E=b.find("#childObjectLevelCRUDBody"),C=GBFields.objectNameToLabelMap[J.split(":")[0]];E.find(".crudObjLabel").text(C).data("objDotNotation",J);if(F){E.find(".flatViewSection input").prop("disabled",false);E.find(".flatViewSection").removeClass("none")}d(J,E,K);E.removeClass("none")}else{b.find("#childObjectLevelCRUDBody").addClass("none")}if(F){if(G.split(":").length>1){D.find(".flatViewSection input").prop("disabled",false);D.find(".flatViewSection").removeClass("none")}else{D.find(".flatViewSection").addClass("none");D.find(".flatViewSection input").prop("disabled",true)}e(true)}}function d(K,R,M){var C=K.split(":"),H=(C.length==2&&C[1].indexOf("unrelated")>-1&&C[1].indexOf("-")>-1);var I=R.find(".isCreateableChkBx"),E=R.find(".isDeletableChkBx"),L=R.find(".isEditableChkBx"),O=R.find(".concatenatedFlatView"),T=R.find(".denormalizedFlatView"),P=R.find(".objLabel"),G=R.find(".objLabelPlural"),Q=R.find(".concatViewColLabel");R.find(".gbInfoIcon.tooltip").tooltipster().focus(function(){s(this).tooltipster("show")}).blur(function(){s(this).tooltipster("hide")});var Y="Disabled due to grid level settings or application restrictions",X=K.split(":")[0];var F=!X.endsWith("__History");var D=(readOnlyObjects.filter(function(aa){return aa==X}).length==0&&F),V=(unsupportedCreateNewObjects.filter(function(aa){return aa==X}).length==0&&F),J=(unsupportedDeleteObjects.filter(function(aa){return aa==X}).length==0),W=!GBChartsConfig.isExternalObject(X);if(gridIsEditable&&D){L.prop("disabled",false).removeAttr("title");if(M[K]&&M[K]["Is_Editable"]!==undefined){R.find(".isEditableChkBx").prop("checked",M[K]["Is_Editable"])}else{R.find(".isEditableChkBx").prop("checked",true)}}else{L.prop("checked",false).prop("disabled",true).attr("title",Y)}if(gridIsCreateable&&V&&!H&&W){I.prop("disabled",false).removeAttr("title");if(M[K]&&M[K]["Is_Createable"]!==undefined){R.find(".isCreateableChkBx").prop("checked",M[K]["Is_Createable"])}else{R.find(".isCreateableChkBx").prop("checked",true)}}else{I.prop("checked",false).prop("disabled",true).attr("title",Y)}if(gridIsDeletable&&J){E.prop("disabled",false).removeAttr("title");if(M[K]&&M[K]["Enable_Deletes"]!==undefined){R.find(".isDeletableChkBx").prop("checked",M[K]["Enable_Deletes"])}else{R.find(".isDeletableChkBx").prop("checked",true)}}else{E.prop("checked",false).prop("disabled",true).attr("title",Y)}if(M[K]&&M[K]["Flat_View_Type"]!==undefined){var N=M[K]["Flat_View_Type"];if(N==h.CONCATENATED){O.prop("checked",true);Q.parent().show()}else{O.prop("checked",false);Q.parent().hide()}if(N==h.DENORMALIZED){T.prop("checked",true);Q.parent().hide()}else{T.prop("checked",false)}}else{if(M[K]==undefined&&GBFields.getSelectedObjectsOnLoad().indexOf(K)==-1){O.prop("checked",true);T.prop("checked",false);Q.parent().show()}else{O.prop("checked",false);T.prop("checked",false);Q.parent().hide()}}if(M[K]&&M[K]["Label"]!==null&&M[K]["Label"]!==""&&M[K]["Label"]!==undefined){var Z=M[K]["Label"];P.val(Z)}else{P.val("")}if(M[K]&&M[K]["Label_Plural"]!==null&&M[K]["Label_Plural"]!==""&&M[K]["Label_Plural"]!==undefined){var U=M[K]["Label_Plural"];G.val(U)}else{G.val("")}if(M[K]&&M[K]["Concatenated_View_Column_Label"]!==null&&M[K]["Concatenated_View_Column_Label"]!==""&&M[K]["Concatenated_View_Column_Label"]!==undefined){var S=M[K]["Concatenated_View_Column_Label"];Q.val(S)}else{Q.val("")}}function f(C){var G=b.find("#objectLevelCRUDBody"),F=G.find(".crudObjLabel").data("objDotNotation"),E=b.find("#childObjectLevelCRUDBody").find(".crudObjLabel").data("objDotNotation");p(G,F);if(F==parentObjectName&&E){var D=b.find("#childObjectLevelCRUDBody");p(D,E)}e(false);if(C){s(".selectedFieldsContent").find('[id="'+F+'"].selectedObjectSection').find(".topSection .icon-ellipses").addClass("on")}}function p(D,L){var J=D.find(".isEditableChkBx:not([disabled])"),H=D.find(".isCreateableChkBx:not([disabled])"),O=D.find(".isDeletableChkBx:not([disabled])"),N=D.find(".concatenatedFlatView:not([disabled])"),F=D.find(".denormalizedFlatView:not([disabled])"),M=D.find(".objLabel"),C=D.find(".objLabelPlural"),I=D.find(".concatViewColLabel");w[L]={};if(M.length>0){w[L]["Label"]=M.val()}if(C.length>0){w[L]["Label_Plural"]=C.val()}if(I.length>0){w[L]["Concatenated_View_Column_Label"]=I.val()}if(J.length>0){var E=J.prop("checked");if(E!=gridIsEditable){w[L]["Is_Editable"]=E}}if(H.length>0){var K=H.prop("checked");if(K!=gridIsCreateable){w[L]["Is_Createable"]=K}}if(O.length>0){var G=O.prop("checked");if(G!=gridIsDeletable){w[L]["Enable_Deletes"]=G}}if(N.length>0||F.length>0){if(N.prop("checked")){w[L]["Flat_View_Type"]=h.CONCATENATED}else{w[L]["Flat_View_Type"]="none"}if(F.prop("checked")){w[L]["Flat_View_Type"]=h.DENORMALIZED;m(D,L)}else{if(r!=null&&r.name==L){A();GBFieldProps.resetPropertyForSave("hl");if(l[L]){delete l[L]["Flat_View_Type"]}}}if(!N.prop("checked")){delete w[L]["Concatenated_View_Column_Label"]}}if(s.isEmptyObject(w[L])){delete w[L]}}function m(E,K){var J=s(String.format('.selectedFieldsContent div[id="{0}"]',K)),N=s(String.format('.selectedFieldsContent div[id="{0}"]',parentObjectName)),C=J.find(".objField"),G=J.find(".dataCardSection"),H=N.find(".primaryFieldsSection"),D=H.find(".objField:not(.dvc)"),I=N.find(".dataCardSection"),M,F;if(r&&r.name!=K){if(w[r.name]){delete w[r.name]["Flat_View_Type"]}if(l[r.name]){delete l[r.name]["Flat_View_Type"]}}A(N);r={name:K,label:E.find(".crudObjLabel").text()};N.attr("data-codf",K);C.addClass("dvc").detach();x(K,C);if(I.length>0&&I.is(":visible")){var O=GBDataCardSettings.getMaxPrimaryFieldsNumber();if((D.length+C.length)>O){var L=s.merge(D,C);H.append(L.slice(0,O));I.append(L.slice(O));I.find(".objField.dvc").each(function(){GBDataCardSettings.updateAdminFieldProperty(s(this).attr("id"),true)});if(N.find(".dataCardEmptyDiv").is(":visible")){N.find(".dataCardEmptyDiv").hide()}}else{H.append(C)}}else{H.append(C)}if(G&&(G.find(".objField").length>0)){c(C)}M=J.find(".relWidget");if(M.length>0){M.detach();N.find(".topSection .icon-ellipses").after(M)}F=J.attr("data-parentobjectfkname");if(F){N.attr("data-parentobjectfkname",F);N.attr("data-pathToJP",J.find(".topSection .relName").text())}s(String.format('.selectedFieldsContent div[id="{0}"]',K)).remove()}function i(C,G){var H=C.find(".relWidget"),F=s(String.format('.selectedFieldsContent div[id="{0}"]',G)),D,E;if(H.length>0){D=H.find(".objSection.parent select").val();E=H.find(".objSection.child select").val();F.find(".relWidget .objSection.parent select").val(D);F.find(".relWidget .objSection.child select").val(E);H.remove()}}function x(E,F){var G=GBFields.objectNameToLabelMap[E.split(":")[0]],D,C;F.each(function(){D=s(this),C=G+"."+D.find(".fieldLabel").text();D.find(".fieldLabel").text(C)})}function A(){var E=s(String.format('.selectedFieldsContent div[id="{0}"]',parentObjectName)),G=E.find(".objField.dvc"),D=E.find(".dataCardSection"),H,C=0,F;if(r!=null){C=GBFields.objectNameToLabelMap[r.name.split(":")[0]].length+1}r=null;G.each(function(){var K=s(this),J=K.find(".fieldLabel").text(),I=K.find(".gbRemoveField");K.find(".fieldLabel").text(J.substring(C));GBFields.toggleField(I,true);if(E.find(K).length>0){E.find(K).remove()}});F=E.attr("data-codf");E.removeAttr("data-codf");i(E,F);H=E.attr("data-parentObjectFkName");if(H){E.removeAttr("data-parentObjectFkName");E.removeAttr("data-pathToJP")}if(D.is(":visible")&&D.find(".objField").length==0){E.find(".dataCardEmptyDiv").show()}}function t(){s(".selectedFieldsContent").on("click","div.selectedObjectSection div.topSection span.icon-ellipses",function(){var C=s(this).closest(".selectedObjectSection"),E=C.attr("id"),F=C.find(".objectLabel").text(),D=C.attr("data-codf");GBMixpanel.track("GW2 View Properties",{Level:"Object"});a(E,F,true,D)});b.find("input.objectLevelCRUDOK").click(function(){f(true)});b.find("input.objectLevelCRUDCancel").click(function(){a();f()});b.find(".isCreateableChkBx").click(function(){if(s(this).is(":checked")){var C=s(this).parents(".objectSettingsSection");C.find(".isEditableChkBx").prop("checked",true)}});b.find(".isEditableChkBx").click(function(){if(!s(this).is(":checked")){var C=s(this).parents(".objectSettingsSection");C.find(".isCreateableChkBx").prop("checked",false)}});b.find(".denormalizedFlatView").click(function(){if(s(this).is(":checked")){var E=b.find("#objectLevelCRUDBody"),D=E.find(".crudObjLabel").data("objDotNotation"),F=E.find(".crudObjLabel").text(),C=true;if(D==parentObjectName){D=s(String.format('.selectedFieldsContent div[id="{0}"]',parentObjectName)).attr("data-codf");E=b.find("#childObjectLevelCRUDBody")}if(r&&r.name!=D){if(confirm("Only one child object can be configured for flat view. Checking this box will uncheck Flat View for "+r.label+". Proceed?")){}else{s(this).prop("checked",false);C=false}}if(C&&E.find(".concatenatedFlatView").is(":checked")){E.find(".concatenatedFlatView").prop("checked",false);b.find(".concatViewColLabel").parent().hide();b.find("input.concatViewColLabel").val("")}}});b.find(".concatenatedFlatView").click(function(){if(s(this).is(":checked")){b.find(".concatViewColLabel").parent().show();if(b.find(".denormalizedFlatView").is(":checked")){b.find(".denormalizedFlatView").prop("checked",false)}}else{b.find(".concatViewColLabel").parent().hide();b.find("input.concatViewColLabel").val("")}})}function e(C){if(C){s("#gbOverlay").show();b.center();b.show()}else{b.hide();s("#gbOverlay").hide()}}function c(C){C.each(function(){GBDataCardSettings.updateAdminFieldProperty(s(this).attr("id"),false)})}function j(){var C=[];for(var D in g){if(g.hasOwnProperty(D)&&w.hasOwnProperty(D)){if(g[D]["Flat_View_Type"]!==w[D]["Flat_View_Type"]){C.push(D.split(":")[0])}}}return C}return{init:u,removeObjectFromCrudSettingsJsonCopy:y,updateCRUDSettingsJSONForSave:B,getIsDenormalizedViewObject:n,getFlatViewSettings:v,clearSelectedDenormalizedViewObject:o,toggleObjectLevelCRUDWidget:e,getChangedFlatViewObjectNames:j}})(window,document,jq);var GBChartsConfig=(function(h,r,s){var i,f="",t=JSON.parse(s('[id*="chartsJson"]').val()),o=t[0]||{},j="donut",B="tile";function w(){if(!GBChartsConfig.enabled){return}for(var C=0;C<t.length;C++){if(t[C].id==undefined){t[C].id=new Date().getTime()}s("#chartsTable #charts").after('<tr id="chart-'+t[C].id+'" class="gbForm chartItem"><td>'+GBFields.htmlEscape(t[C].title)+"</td></tr>")}s("#chartsTable").on("click","tr.chartItem",function(){if(s(this).attr("id").replace("chart-","")!=o.id){A(s(this))}});s("#chartsTable").on("blur","#chartTitleInput",function(){if(s(this).val()&&s(this).val()!=""){var D=s("#chart-"+o.id+" td");D.text(s(this).val()).html()}});m();d();q();s("#chartXWedgeSelect").change(m);s("#chartYValueSelect").change(m);s("#chartTileFieldSelect").change(q);s("#chartGroupBySelect").change(m);s("#addChartButton").on("click",{focus:true},n);s("#deleteChartButton").on("click",c);if(t.length==0){n();z(s(".chartConfigOptions"),"line")}A(s("#chartsTable #charts").next(),true);s(".chartConfigSection .tooltip").tooltipster().focus(function(){s(this).tooltipster("show")}).blur(function(){s(this).tooltipster("hide")});s("#chartColorSelect .colorPickerRow div").click(function(){s(this).closest(".colorPickerDiv").find(".colorPickerRow div").removeClass("selected");s(this).addClass("selected")})}function A(D,E){if(D.length==0||t.length==0){b();s("#chartsTable #noChartDataText").show();s("#chartsTable .hideIfNoData").hide();u();return}else{s("#chartsTable #noChartDataText").hide();s("#chartsTable .hideIfNoData").show()}var F=D.attr("id").replace("chart-","");if(!E){a(o.id)}b();s("#chartsTable .chartItem").removeClass("highlightRow");D.addClass("highlightRow");for(var C=0;C<t.length;C++){if(t[C].id==F){o=t[C];break}}f=o.type;z(s(".chartConfigOptions"),f);e()}function n(D){var C=new Date().getTime();a(o.id);o={id:C};t.push({id:C});s("#chartsTable .chartItem").removeClass("highlightRow");s("#chartsTable #charts").after('<tr id="chart-'+C+'" class="gbForm chartItem highlightRow"><td class="gridProfile-title">New Chart</td></tr>');b();A(s("#chartsTable #charts").next());if(t.length==1){p()}if(D&&D.data&&D.data.focus){s("#chartTitleInput").focus()}}function c(){if(!o.id){alert("Please select a chart to delete.");return}var C=confirm("Are you sure you want to delete this chart?");if(C){for(var D=0;D<t.length;D++){if(t[D].id==o.id){removeIndex=D;break}}t.splice(removeIndex,1);s("#chartsTable #chart-"+o.id).remove();A(s("#chartsTable #charts").next())}}function a(D){for(var C=0;C<t.length;C++){if(t[C].id==D){t[C].type=s(".chartConfigContainer .chartButton.selected").attr("id");t[C].title=s("#chartTitleInput").val().trim();t[C].size=s("#chartSizeSelect").val();t[C].x_wedge=s("#chartXWedgeSelect").val();t[C].y_value=s("#chartYValueSelect").val();if(t[C].type!=j){t[C].group_by=s("#chartGroupBySelect").val();t[C].data_labels=s("#chartShowLabelsInput").prop("checked")}if(t[C].type==B){t[C].y_value=s("#chartTileFieldSelect").val();t[C].summary_type=s("#chartSummaryTypeSelect").val();t[C].description=s("#chartDescriptionInput").val();t[C].color=s("#chartColorSelect .selected").attr("data-colorId")}}}}function e(){if(!o){return}if(o.title){s("#chartTitleInput").val(o.title)}if(o.type){s(".chartConfigContainer .chartButton#"+o.type).click()}if(o.size&&o.size!=0){s("#chartSizeSelect").val(o.size)}if(o.x_wedge&&o.x_wedge!=0){s("#chartXWedgeSelect").val(o.x_wedge)}if(o.y_value&&o.y_value!=0){if(o.type==B){s("#chartTileFieldSelect").val(o.y_value)}else{s("#chartYValueSelect").val(o.y_value)}}if(o.group_by&&o.group_by!=0){s("#chartGroupBySelect").val(o.group_by)}if(o.data_labels){s("#chartShowLabelsInput").prop("checked",o.data_labels)}if(o.summary_type&&o.summary_type!=0){s("#chartSummaryTypeSelect").val(o.summary_type)}if(o.description){s("#chartDescriptionInput").val(o.description)}if(o.color){s("#chartColorSelect .color-"+o.color).addClass("selected")}else{s("#chartColorSelect .colorPickerRow .color-1").addClass("selected")}}function d(){s(".chartConfigContainer .chartButton").click(function(){s(".chartConfigContainer .chartButton").removeClass("selected");f=s(this).addClass("selected").attr("id");o.type=s(this).addClass("selected").attr("id");z(s(".chartConfigOptions"),f);q()})}function b(){s(".chartConfigRow #line").click();s("#chartTitleInput").val("");f="";s(".chartConfigContainer .chartButton").removeClass("selected");s("#chartSizeSelect").val(0);s("#chartXWedgeSelect").val(0);s("#chartYValueSelect").val(0);s("#chartTileFieldSelect").val(0);s("#chartGroupBySelect").val(0);s("#chartShowLabelsInput").prop("checked",false);s("#chartColorSelect .colorPickerRow div").removeClass("selected");s("#chartDescriptionInput").val("");GBChartsConfig.populateDropdowns()}function v(){var C={};var D=false;s(".selectedFieldsContent .objField").each(function(){var I=false;var E=s(this).attr("data-odf");var H=E.split(":");if(k(H[0])){if(H.length==3){I=true}else{if(D==false){D=true}}}else{if(D==true&&H.length==3){I=true}}if(s(this).attr("id").indexOf("unrelated")==-1&&I==false){var F=GBFields.getFieldObjectProperties(this),G=GBFields.constructObjectDotField(F.objectName,F.fieldName,F.objectFk);C[G]=F}});return C}function m(R){if(!GBChartsConfig.enabled){return}var H=v(),U=s("#chartXWedgeSelect").val()||o.x_wedge,S=s("#chartYValueSelect").val()||o.y_value,K=s("#chartGroupBySelect").val()||o.group_by,W=s("#chartTileFieldSelect").val()||o.y_value,E=s("#chartXWedgeSelect").empty(),V=s("#chartYValueSelect").empty(),M=s("#chartTileFieldSelect").empty(),F=s("#chartGroupBySelect").empty(),C=['<option value="0">--Select--</option>'],D=['<option value="0">--Select--</option>'],T=['<option value="0">--Select--</option>'],L=['<option value="0">--Select--</option>'],G=(U)?U.split(":"):undefined,I=(S)?S.split(":"):undefined,P=(K)?K.split(":"):undefined,O="",Q="",J=[];optionString="",parentApiName="",objectLabel="",parentLabel="",recordCountParentApiNameArray=[],isYOnParent=false,isXOnParent=false,isGroupByOnParent=false,isCurrentFieldOnTheParent=false,recordCountValue="",currentDropdown=(!this.window)?s(this):undefined,childObjectsArray=[],chartErrorMessageArray=[],chartSaveBtn=s(".chartButtons .saveBtn");if(S){isYOnParent=(I.length==2);if(isYOnParent&&((G&&G.length==3)||(P&&P.length==3))){parentLabel=GBFields.objectNameToLabelMap[I[0]];chartErrorMessageArray.push("You've selected a parent "+GBFields.htmlEscape(parentLabel)+" field for the Y-Axis. The X-Axis and Group By fields must also be fields from the "+GBFields.htmlEscape(parentLabel)+" object.")}}for(var N in H){O=H[N].dataType;Q=H[N].labelName;J=N.split(":");parentApiName=J[0];objectLabel=GBFields.objectNameToLabelMap[parentApiName];isCurrentFieldOnTheParent=J.length==2;if(O=="PICKLIST"||O=="STRING"||O=="COMBOBOX"||O=="EMAIL"||O=="PHONE"||O=="REFERENCE"||O=="BOOLEAN"||O=="DATE"||O=="DATETIME"){if(!isYOnParent||(isYOnParent&&isCurrentFieldOnTheParent)){optionString='<option value="'+N+'">'+GBFields.htmlEscape(objectLabel)+"."+GBFields.htmlEscape(Q)+" ("+O+")</option>";C.push(optionString);L.push(optionString)}}if(recordCountParentApiNameArray.indexOf(parentApiName)==-1){if(isCurrentFieldOnTheParent){recordCountValue=parentApiName+":RECORD_COUNT"}else{recordCountValue=parentApiName+":RECORD_COUNT:"+J[2]}optionString='<option value="'+recordCountValue+'">'+GBFields.htmlEscape(objectLabel)+" Record Count</option>";D.push(optionString);recordCountParentApiNameArray.push(parentApiName);if(isCurrentFieldOnTheParent){T.push(optionString)}}if(O=="INTEGER"||O=="DOUBLE"||O=="CURRENCY"||O=="PERCENT"){optionString='<option value="'+N+'">'+GBFields.htmlEscape(objectLabel)+"."+GBFields.htmlEscape(Q)+" ("+O+")</option>";D.push(optionString);if(isCurrentFieldOnTheParent){T.push(optionString)}}}E.append(C.join(""));V.append(D.join(""));M.append(T.join(""));F.append(L.join(""));if(U&&U!=0){F.find('option[value="'+U+'"]').remove();V.find('option[value="'+U+'"]').remove()}if(S&&S!=0){E.find('option[value="'+S+'"]').remove();F.find('option[value="'+S+'"]').remove()}if(K&&K!=0){E.find('option[value="'+K+'"]').remove();V.find('option[value="'+K+'"]').remove()}if(E.find('option[value="'+U+'"]').length!=0){E.val(U||0)}else{E.val(0)}if(V.find('option[value="'+S+'"]').length!=0){V.val(S||0)}else{V.val(0)}if(F.find('option[value="'+K+'"]').length!=0){F.val(K||0)}else{F.val(0)}if(M.find('option[value="'+W+'"]').length!=0){M.val(W||0)}else{M.val(0)}if(U&&G.length==3){childObjectsArray.push(G[0])}if(S&&I.length==3){if(childObjectsArray.indexOf(I[0])==-1){childObjectsArray.push(I[0])}}if(K&&P.length==3){if(childObjectsArray.indexOf(P[0])==-1){childObjectsArray.push(P[0])}}if(childObjectsArray.length>1){currentDropdown.val(0);chartErrorMessageArray.push("You've selected chart fields from multiple related objects. Please choose fields from the same related object.")}if(K&&K!=0&&U&&U!=0&&S&&S!=0){isXOnParent=(G.length==2);isGroupByOnParent=(P.length==2);relatedLabel=GBFields.objectNameToLabelMap[childObjectsArray[0]];if(isGroupByOnParent&&!isXOnParent&&!isYOnParent){chartErrorMessageArray.push("Both the X-Axis and Y-Axis chart fields are from "+GBFields.htmlEscape(relatedLabel)+". The Group By chart field must also be from "+GBFields.htmlEscape(relatedLabel)+".");F.val(0)}}if(chartErrorMessageArray.length>0){l(chartErrorMessageArray.join("<br>"),true)}else{g()}}function q(D){if(s(".chartConfigContainer .chartButton#tile").hasClass("selected")){var C=s("#chartTileFieldSelect").val().indexOf("RECORD_COUNT")!=-1;if(C){s(".summaryTypeRow").hide()}else{s(".summaryTypeRow").show()}}}function x(){if(!GBChartsConfig.enabled){return}var D=[],E=[];var F=[];a(o.id);if(t.length<=1){if(y(t[0])){s('[id*="chartsJson"]').val("[]");return F}}for(var C=0;C<t.length;C++){if(y(t[C])==false){if(!t[C].title||t[C].title==undefined||t[C].title.trim()==""){F=["Enter a Title for all charts."];return F}if(E.indexOf(t[C].title)>-1){F=['Specify a unique value for Title for the chart "'+t[C].title+'".'];return F}else{E.push(t[C].title)}if(!t[C].type||t[C].type==undefined||t[C].type==""){F.push('Select Type for the chart "'+t[C].title+'".')}if(!t[C].size||t[C].size==undefined||t[C].size=="0"){F.push('Select Size for the chart "'+t[C].title+'".')}if(!t[C].x_wedge||t[C].x_wedge==undefined||t[C].x_wedge==""||t[C].x_wedge=="0"){if(t[C].type==j){F.push('Select value for the Wedges for the chart "'+t[C].title+'".')}else{if(t[C].type=="line"||t[C].type=="bar"){F.push('Select value for the X-Axis for the chart "'+t[C].title+'".')}}}if(!t[C].y_value||t[C].y_value==undefined||t[C].y_value==""||t[C].y_value=="0"){if(t[C].type==j){F.push('Select Values for the chart "'+t[C].title+'".')}else{if(t[C].type==B){F.push('Select Field for the chart "'+t[C].title+'".')}else{F.push('Select Y-Axis for the chart "'+t[C].title+'".')}}}if(t[C].type==B){if(t[C].summary_type==""||t[C].summary_type==undefined||t[C].summary_type=="0"){F.push('Select Summary Type for the chart "'+t[C].title+'".')}if(t[C].description==""||t[C].description==undefined){F.push('Select Description for the chart "'+t[C].title+'".')}if(t[C].color==""||t[C].color==undefined){F.push('Select Color for the chart "'+t[C].title+'".')}}D.push(t[C])}}s('[id*="chartsJson"]').val(JSON.stringify(D));return F}function l(D,C){if(C){D=s("#chartErrorMessage .msgDetail").html()+'<div id="dynamic-chart-errors">'+D+"</div>"}s("#chartErrorMessage .msgDetail").html(D);s("#chartErrorMessage").show()}function g(){s("#chartErrorMessage .msgDetail #dynamic-chart-errors").remove()}function z(C,D){if(D==j){C.find(".showOnDefault").hide();C.find(".showOnTile").hide();C.find(".showOnDonut").show()}else{if(D==B){C.find(".showOnDonut").hide();C.find(".showOnDefault").hide();C.find(".showOnTile").show()}else{C.find(".showOnDonut").hide();C.find(".showOnTile").hide();C.find(".showOnDefault").show()}}}function u(){s("#deleteChartButton").prop("disabled",true).addClass("gbBtnDisabled");s("#embedChartButton").prop("disabled",true).addClass("gbBtnDisabled")}function p(){s("#deleteChartButton").prop("disabled",false).removeClass("gbBtnDisabled");s("#embedChartButton").prop("disabled",false).removeClass("gbBtnDisabled")}function y(C){if(C==null||C==undefined||s.isEmptyObject(C)||Object.keys(C).length<=1){return true}for(var D in C){if(D!="id"&&C[D]!=undefined&&C[D]!=""&&C[D]!=0&&C[D]!=false){return false}}return true}function k(C){return C.endsWith("__x")}return{enabled:i,init:w,updateChartsJSONForSave:x,populateDropdowns:m,showHideSummaryDropdown:q,showChartFields:z,showErrorMessage:l,hideErrorMessage:g,donut:j,tile:B,isExternalObject:k}})(window,document,jq);var GBEmbedChart=(function(h,k,l){var f=l("#embedChart"),e="",m="",c="",i=GBChartsConfig.donut,u=GBChartsConfig.tile;function o(){if(metaServiceDisabled){f.find("input.embedCreate").prop("disabled",true).removeClass("gbBtn").addClass("gbBtnDisabled").attr("title","Enable the GridBuddy Meta Data service to be able to create Visualforce pages for embedding charts.")}g();n()}function g(){e=l(".chartConfigContainer .chartButton.selected").attr("id")||"";m=l("#chartSizeSelect").val();c=l("#chartTitleInput").val();l("#embedBody .chartButton").removeClass("selected");if(e){l("#embedBody #"+e).addClass("selected");GBChartsConfig.showChartFields(f,e)}if(m){l("#embedChartSizeSelect").val(m)}q()}function n(){l(".chartEmbedBtn").click(function(x){var w=l(this).closest(".chartConfigOptions");GBMixpanel.track("GW2 Button Click",{Type:"Embed Chart"});if(hasSelectedFields&&gridHasValidObjects){var v=GBChartsConfig.updateChartsJSONForSave();if(v.length==0&&l("#chartTitleInput").val()==""){showWarningMessage(w,"Please specify the chart configuration values before embedding a chart.",x)}else{if(v.length==0){GBChartsConfig.hideErrorMessage();g();a(true)}else{GBChartsConfig.showErrorMessage(v.join("<br>"));showWarningMessage(w,"Please specify the chart configuration values before embedding a chart.",x)}}}else{showWarningMessage(w,"Please save the grid before embedding a chart.",x)}});f.find("span.closeX, input.embedCancel").click(function(){a(false)}).keyup(function(v){if(v.keyCode==13){l(this).trigger("click")}});f.find(".chartButton").click(function(){f.find(".chartButton").removeClass("selected");e=l(this).addClass("selected").attr("id");GBChartsConfig.showChartFields(f,e);q();GBChartsConfig.showHideSummaryDropdown()});f.find("#embedChartSizeSelect").change(function(){m=l(this).val();q()});f.find("input.embedCreate").click(function(){if(!p()){alert("Please enter values for required fields.");return}GBMixpanel.track("GW2 Button Click",{Type:"Create Chart Page"});t(lang.processing);r();createChartsVFpageAF()})}function p(){var v=true;if(m==null||m==0){v=false}if(e==null||e==""){v=false}return v}function b(){d();j()}function a(v){if(v){l("#gbOverlay").show();f.center();f.show()}else{f.hide();l("#gbOverlay").hide()}}function q(){var v="";if(m!=0){v=m}vfText='<apex:page showHeader="false" sidebar="false" standardStylesheets="true">\n\t<'+nameSpacePrefix+':ChartComponent gridName="'+gridName+'" chartName="'+c+'" size="'+v+'" type="'+e+'" uniqueChartNumber="1" />\n</apex:page>';f.find("#embedVfText").text(vfText);l("[id*=pageBodyForEmbedChart]").val(vfText)}function s(){t(lang.processing);r();checkEmbedStatusForChartAF()}function r(){l("input[type=submit], input.actionBtn").addClass("none");l("input.gbBtnDisabled").removeClass("none");l(k.body).css("cursor","progress")}function j(){l("input.gbBtnDisabled").addClass("none");l("input[type=submit], input.actionBtn").removeClass("none");l(k.body).css("cursor","default")}function t(v){l("#gridStatus .msgText").text(v);l("#gridStatus").center();l("#gridStatus").show()}function d(){l("#gridStatus").hide()}return{init:o,completeEmbedRequest:b,getEmbedStatus:s}})(window,document,jq);var GBSearch=(function(g,i,a){function d(){a(".fieldsContainer .clearSearch").click()}function j(){a(".searchBox").keyup(function(){var k=c(a(this));b(k)}).keypress(function(l){if(l.keyCode==13){var k=c(a(this));b(k);l.preventDefault()}});a(".clearSearch, .showMeAllObjectsOrFields").click(function(){var k=c(a(this));k.find(".searchBox").val("");b(k)})}function h(){var k=c(a(".fieldsContainer .searchBox"));b(k)}function f(l,k){l.find(".noSearchResults").addClass("none");if(k){var m=l.find(".objectHeading:not(.none)");m.show();l.find(".objName").show()}else{l.find(".selectedObject").removeClass("none");l.find(".objField").show()}}function c(k){if(k.closest(".objectsContainer").length>0){return k.closest(".objectsContainer")}else{return k.closest(".fieldsContainer")}}function b(p){var o,k=p.hasClass("objectsContainer"),q=p.find(".searchBox");if(k){var n=a(".relatedChildObjects"),m=n.hasClass("noData");o=p.find(".objectsContent").find(".parentObjectName .objectLabel, .relatedChildObjects .objName, .allObjects:not(.none) .objName");o.removeHighlight()}else{var l=p.find(".fieldsContent .objectFields .objField").find(".fieldLabel, .fieldApiName");l.removeHighlight();o=p.find(".fieldsContent .objectFields .objField").find(".fieldLabel, .fieldApiName:not(.hidden)")}if(q.val().length>0){o.highlight(q.val(),true);e(p,k);if(k&&m){n.hide()}}else{f(p,k);if(k&&m){n.show()}}}function e(m,k){var l,o;if(k){var n=m.find(".objectHeading:not(.none)");l=m.find(".parentObjectName, .relatedChildObjects, .allObjects:not(.none)");o=l.find(".highlight"),l.find(".objName").hide()}else{l=m.find(".objectFields");o=l.find(".highlight");l.find(".objField").hide()}if(o.length>0){m.find(".noSearchResults").addClass("none");if(k){o.closest(".objName").show();n.show();n.each(function(){var p=a(this);if(p.next("div").find(".highlight").length==0){p.hide()}})}else{m.find(".selectedObject").removeClass("none");o.closest(".objField").show()}}else{m.find(".noSearchResults").removeClass("none");if(k){n.hide()}else{m.find(".selectedObject").addClass("none")}}}return{clearSearchForChooseFieldsSection:d,init:j,refreshFieldSearch:h}})(window,document,jq);var GBDataCardSettings=(function(i,k,c){var p=7;function o(q){j(q);a(q)}function d(){return p}function m(q){q.find(".dataCardEmptyDiv").css("display","none")}function l(q){q.find(".dataCardEmptyDiv").css("display","block")}function e(){return c(".selectedObjectSection .topSection").filter(function(){if(c(this).find(".icon-wrap").length==0){return false}return c(this).find(".icon-wrap").hasClass("on")}).length>0}function g(r,q){var s=GBFieldProps.getAdminFieldProperties();var t=GBFieldProps.getRowIdStringUnrelated(r);if(!s[t]){s[t]={}}s[t].dcf=q;GBFieldProps.setAdminFieldProperties(s)}function j(q){q.find(".objectAndApiNameContainer").append('<span class="icon-wrap"></span>');c("<span class='gbInfoIcon'></span>").tooltipster({content:"Enable or disable Data Cards for this object"}).appendTo(q.find(".icon-wrap"));q.find(".topSection").after('<div class="primaryFieldsLabel">Primary Fields</div>');c("<span class='gbInfoIcon'></span>").tooltipster({content:"These fields will appear in a row above the Data Card fields. Include the key fields here users need to see and access most often."}).appendTo(q.find(".primaryFieldsLabel"));c(q).append(n());c("<span class='gbInfoIcon'></span>").tooltipster({content:"These fields will appear in a section below the Primary Fields in a column layout. Data Card fields will be hidden by default and can be displayed by toggling the Data Card icon on the row. Include fields here users need to see and access occasionally."}).appendTo(q.find(".dataCardFieldsLabel"))}function n(){return'<div class="dataCardFieldsLabel">Data Card Fields</div><div class="dataCardSection"></div><div class="dataCardEmptyDiv">drag fields here</div>'}function a(r){var s=r.find(".primaryFieldsSection"),q=r.find(".dataCardSection"),u=r.find('.primaryFieldsLabel, [class^="dataCard"]'),t=r.find(".dataCardEmptyDiv");r.on("click",".icon-wrap",function(){if(c(this).hasClass("on")){if(!i.confirm("Remove the Data Card option for this object? All selected fields will be displayed in row layout and visible by default.")){return}h(u);c(this).removeClass("on");b(r)}else{f(u);c(this).addClass("on");if(s.find(".objField").length>GBDataCardSettings.getMaxPrimaryFieldsNumber()){var v=s.find(".objField:nth-child("+GBDataCardSettings.getMaxPrimaryFieldsNumber()+")").nextAll(".objField");q.append(v);t.hide();v.each(function(){GBDataCardSettings.updateAdminFieldProperty(c(this).attr("id"),true)})}else{t.show()}}});s.sortable({items:"div.objField",connectWith:q});q.sortable({items:"div.objField",connectWith:s,receive:function(w,v){if(s.find(".objField").length==0){v.sender.sortable("cancel");return}if(t.is(":visible")){t.hide()}g(v.item.attr("id"),true)},remove:function(x,w){var v=q.find(".objField").length==0;if(v){t.show()}g(w.item.attr("id"),false)}})}function f(q){q.show()}function h(q){q.hide()}function b(r){var q=r.find(".dataCardSection"),s=q.find(".objField");if(s.length>0){s.each(function(){r.find(".primaryFieldsSection").append(c(this));g(c(this).attr("id"),false)})}}return{init:o,getMaxPrimaryFieldsNumber:d,hidePlaceHolder:m,showPlaceHolder:l,updateAdminFieldProperty:g,isFeatureEnabled:e}})(window,document,jq);var GBMixpanel=(function(i,l,n){function r(t){if(isTrackingDisabled||(typeof mixpanel=="undefined")){return}mixpanel.init(t,{cross_site_cookie:true});d()}function m(t,u){if(isTrackingDisabled||(typeof mixpanel=="undefined")){return}if(!u){u={}}var v=n.extend({},u,{"Org ID":orgId,"Grid Name":gridName,"GridBuddy Edition":gbEdition,"GridBuddy Version":gridBuddyVersion,"User ID":userId,"User Type":abbreviatedUserType,"UI Theme":uiTheme,"User Language":userLanguage,"Lightning Style Enabled":lightningStylesEnabled,"OS Version":q()});mixpanel.people.set({"User ID":userId,"User Type":uiTheme,"UI Theme":abbreviatedUserType,"User Language":userLanguage});mixpanel.identify(userId);mixpanel.track(t,v)}function q(){var v="Unknown OS";var u=navigator.userAgent;if(u&&(u.indexOf("Firefox")==-1)){var t=navigator.appVersion;if(t.indexOf("Mac")!=-1){v=t.match(/([Mac]+.+)/)[1]}else{if(t.indexOf("Windows")){v=t.match(/([Windows]+.+)/)[1]}}}else{if(u.indexOf("Firefox")!=-1){v=navigator.oscpu}}return v}function d(){n(".gbwForm").on("click",".gbBtn",function(){var t=n(this);if(t.hasClass("manageActionsBtn")){GBMixpanel.track("GW2 Button Click",{Type:"Manage Actions"})}})}function p(){if(isTrackingDisabled||(typeof mixpanel=="undefined")){return}var A=n(".selectedFieldsContent").find(".selectedObjectSection:not(.parent)"),t=b(),y=c(),x=GBCRUDSettings.getFlatViewSettings(),v=(x.flatViewEnabledObjects||""),w=(x.editableRelatedColumnObjects||""),z=e(),u={"# Selected Objects":n(".selectedFieldsContent").find(".selectedObjectSection").length,"Selected Objects":y,"Selected Fields":g(),"# Selected Fields":n(".selectedFieldsContent .objField").length,"Has Unrelated Objects":(A.filter(function(){return this.id.match(/:unrelated$/)}).length>0),"Has Junction Objects":(A.filter(function(){return this.hasAttribute("data-parentobjectfkname")}).length>0),"Has External Objects":(n(".selectedObjectSection").filter(function(){return this.id.match(/__x/)}).length>0),"Has Chart":(o(z)>0),"# Charts":o(z),"Chart Type":j(z),"Chart Size":h(z),"# Formatting Rules":t,"# Actions Selected":n("#gbActions").find("tr:not(.gradientHeader)").find("input[type=checkbox]:checked").length,"Flat View Enabled":v,"Editable Related Column Enabled":w,"# Objects With Data Card":f(),"Max # Primary Fields":s(),"Max # Data Card Fields":a(),"# Quick Filter Fields":k(),};GBMixpanel.track("GW2 Save",u);mixpanel.people.increment("GW2 Save")}function c(){var t=n(".selectedFieldsContent").children(),v=[];for(var u=0;u<t.length;u++){v.push(t[u].id.split(":")[0])}return v.join(",")}function g(){var t=[],w=n(".primaryFieldsSection, .dataCardSection").children();for(var v=0;v<w.length;v++){var u=w[v].dataset.odf.split(":");t.push(u[0]+"."+u[1]+"."+w[v].dataset.fdt)}return t.join(",")}function e(){return JSON.parse(n('[id*="chartsJson"]').val())}function o(t){return t.length}function j(v){var u=[];if(v.length>0){for(var t=0;t<v.length;t++){u.push(v[t].type)}}return u.join(",")}function h(w){var v=[],t={xs:"Extra Small",s:"Small",m:"Medium",l:"Large"};if(w.length>0){for(var u=0;u<w.length;u++){v.push(t[w[u].size])}}return v.join(",")}function b(){var u=n("#rules").siblings().length,t;if((u==1)&&(n("#colorCodeNameInput").val()=="")){t=0}else{t=u}return t}function f(){if(!GBDataCardSettings.isFeatureEnabled()){return 0}return n(".selectedObjectSection .topSection").filter(function(){return n(this).find(".icon-wrap").hasClass("on")}).length}function s(){var t=[];if(!GBDataCardSettings.isFeatureEnabled()){return 0}n(".selectedObjectSection .primaryFieldsSection").each(function(){t.push(n(this).find(".objField").length)});return(t.length>0)?Math.max.apply(Math,t):0}function a(){var t=[];if(!GBDataCardSettings.isFeatureEnabled()){return 0}n(".selectedObjectSection .dataCardSection").each(function(){t.push(n(this).find(".objField").length)});return(t.length>0)?Math.max.apply(Math,t):0}function k(){var v=GBFieldProps.getAdminFieldProperties(),t=0;for(var u in v){if(v[u].qf==true){t++}}return t}return{init:r,track:m,pageLevelSubmit:p}})(window,document,jq);