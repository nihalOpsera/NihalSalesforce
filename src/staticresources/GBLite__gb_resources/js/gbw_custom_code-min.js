var jq=jQuery.noConflict();jq(document).ready(function(){GBButtons.updateAndShowButtons();GBCustomCodeConfig.init();GBMixpanel.init(mpToken);GBMixpanel.track("Page View",{Page:"MCC"})});var GBCustomCodeConfig=(function(A,b,g){var r="Global CSS",o="Global JavaScript",q="CSS",v="JavaScript",k="Tabbed Page",J="Grid",e,t={},m={},d=-1,h;function n(L){e=L.customCodeRecords}function D(){u();B();w();c();g(".gbForm").attr("autocomplete","off")}function B(){h=ace.edit("codeBody");h.setTheme("ace/theme/chrome");h.$blockScrolling=Infinity}function c(){var M=p("cid");if(!M){M=localStorage.getItem("lastAccessedCustomCodeId")}if(M){var L=g('#customCodeList tr[id="'+M+'"]');if(L.length>0){L.find("td.codeSummary").click()}}}function p(N){var M=A.location.search,O="";if(M){var L=M.split("&");g.each(L,function(P,Q){if(Q.match(N+"=")){O=Q.substring(Q.indexOf("=")+1);return false}})}return O}function w(){g("#customCodeList").on("click","td.codeSummary",function(L){I(g(this).parent("tr").attr("id"));f(g(this).parent("tr"))});g(".gbwPage").on("click",".addNewBtn",function(L){F()});g("#customCodeList").on("click","span.minus",function(L){G(g(this).closest("tr"))});g(".gbwPage").on("click",".saveCodeBtn",function(L){K(L)});g(".gbwPage").on("click",".deleteBtn",function(L){y()});g("#codeDetails").on("change","input, select",function(){a(g(this));E();z();if(g(this).hasClass("codeType")){H(g(this).val())}});h.getSession().on("change",function(L){E();z()});g(".closeX").click(function(){C()}).keyup(function(L){if(L.keyCode==13){g(this).trigger("click")}});g(b).keyup(function(L){if(L.keyCode==27){C()}});g(b).keydown(function(L){if(!L){L=A.event}if(L){if(L.keyCode==83&&(L.ctrlKey||L.metaKey)){K(L);L.preventDefault()}}});g("#codeDetails .tooltip").tooltipster().focus(function(){g(this).tooltipster("show")}).blur(function(){g(this).tooltipster("hide")})}function K(M){if(g.isEmptyObject(m)){alert("No changes since last save.");return}var L=s();if(L==null){x()}else{l(g(".saveCodeBtn"),L,M)}}function H(L){if(L.indexOf("JavaScript")>-1){h.getSession().setMode("ace/mode/javascript")}else{h.getSession().setMode("ace/mode/css")}}function l(P,O,L){var M=g("#vldWarning"),N=g(P).position();M.find(".msgBody").html(O);M.css("top",(N.top*1+23));M.css("left",(N.left*1+10));M.show();L.stopPropagation();g(A).scrollTop(N.top)}function C(){if(g("#vldWarning").is(":visible")==true){g("#vldWarning").hide()}}function y(){var N=g("#customCodeList input.codeCheck:checked"),M=[],O,P,L="Delete selected extension(s)? This will remove the functionality from any associated grids or tabbed pages.";if(N.length==0){alert("No records marked for deletion.");return}N.each(function(){O=g(this).closest("tr.codeRow").attr("id");P=(m[O]||t[O]);if(P.codeType==r||P.codeType==o){L+=" Deleting global extensions will impact all ";if(P.codeScope==k){L+="tabbed pages."}else{L+="grids."}return false}});if(confirm(L)){N.each(function(){M.push(g(this).closest("tr.codeRow").attr("data-recordId"))});g('[id*="idsToDelete"]').val(JSON.stringify(M));deleteCustomCode()}return}function a(M){if(M.is("input")||M.is("select")){var N=g("#codeDetails").attr("data-codeId"),L=g("#customCodeList").find("tr#"+N);if(M.hasClass("codeSummary")){L.find("td.codeSummary").text(M.val())}else{if(M.hasClass("codeType")){L.find("td.codeType").text(M.val())}}L.find("td.codeSummary, td.codeType").addClass("orange")}}function E(){var M=g("#codeDetails").attr("data-codeId"),L=g("#customCodeList").find("tr#"+M);if(g("#codeDetails").find("input.codeSummary").val()){L.find("td.codeSummary").removeClass("red")}if(g("#codeDetails").find("select.codeType").val()){L.find("td.codeType").removeClass("red")}if(h.getValue()&&g("#codeDetails").find("input.codeSummary").val()&&g("#codeDetails").find("select.codeType").val()){L.find("td.codeSummary, td.codeType").removeClass("red")}}function u(){var N,L=[];if(e.length==0){return}for(var M=0;M<e.length;M++){N=e[M];L=L.concat(j(N,false))}g("#customCodeList").append(L.join(""));g("#customCodeList .codeListInfo").addClass("none")}function j(N,M){var L=[];L.push('<tr class ="codeRow" id="'+N.codeId+'" data-recordId="'+N.recordId+'" >');L.push("<td>");if(M){L.push('<span class="minus">&nbsp;</span>')}else{L.push('<input class="codeCheck" type="checkbox"/>')}L.push("</td>");L.push('<td class="codeSummary">');L.push(N.summary);L.push("</td>");L.push('<td class="codeType">');L.push(N.codeType);L.push("</td>");L.push("</tr>");t[N.codeId]=N;return L}function F(){var M={},L=[];M.codeId=d;M.summary="New extension";M.codeType="JavaScript";M.codeScope="Grid";M.codeBody="";L=L.concat(j(M,true));d--;g("#customCodeList").append(L.join(""));g("#customCodeList").find("#"+M.codeId+" td.codeSummary").addClass("orange").click();g("#customCodeList .codeListInfo").addClass("none");g("#codeDetails .inputs .codeSummary").change();h.getSession().setMode("ace/mode/javascript")}function G(L){delete t[L.attr("id")];delete m[L.attr("id")];g("#codeDetails").removeAttr("data-codeId").addClass("none");g("#codeDetails").find("input, select, textarea").val("");g("#codeDetailsInfo").removeClass("none");L.remove();if(g("#customCodeList").find("tr").length==2){g("#customCodeList .codeListInfo").removeClass("none")}}function z(){var M=g("#codeDetails").attr("data-codeId"),L={};L.summary=g("#codeDetails").find("input.codeSummary").val();L.codeType=g("#codeDetails").find("select.codeType").val();L.codeScope=g("#codeDetails").find("select.codeScope").val();L.codeBody=h.getValue();L.recordId=g("#codeDetails").attr("data-recordId");m[M]=L}function s(){var U,T,P,S=false,L=[],V=[],R=[],Q=[],M=[],N=[];for(U in m){P=m[U];if(!P.summary||!P.codeType||!P.codeBody||!P.codeScope){if(!S){N.push("Name, Type, and Code Body are required for all extensions.");S=true}L.push(U)}if(P.codeType==o){if(P.codeScope==k){V.push(U)}else{R.push(U)}}else{if(P.codeType==r){if(P.codeScope==k){Q.push(U)}else{M.push(U)}}}}for(U in t){T=t[U];P=m[U];if(T.codeType==o&&!P){if(T.codeScope==k){V.push(U)}else{R.push(U)}}else{if(T.codeType==r&&!P){if(T.codeScope==k){Q.push(U)}else{M.push(U)}}}}if(R.length>1){N.push("There can only be one Global JavaScript extension for Grids.");L=L.concat(R)}if(M.length>1){N.push("There can only be one Global CSS extension for Grids.");L=L.concat(M)}if(V.length>1){N.push("There can only be one Global JavaScript extension for Tabbed Pages.");L=L.concat(V)}if(Q.length>1){N.push("There can only be one Global CSS extension for Tabbed Pages.");L=L.concat(Q)}if(N.length>0){for(var O=0;O<L.length;O++){g('#customCodeList tr[id="'+L[O]+'"] td').addClass("red")}return N.join("<br/>")}return null}function x(){g('[id*="editedCustomCodeInput"]').val(JSON.stringify(m));GBMixpanel.trackSave();saveCustomCode()}function I(L){var M=(m[L]||t[L]);g("#codeDetails").attr("data-recordId",M.recordId);g("#codeDetails").attr("data-codeId",L);g("#codeDetails").find("input.codeSummary").val(i(M.summary));g("#codeDetails").find("select.codeType").val(M.codeType);g("#codeDetails").find("select.codeScope").val(M.codeScope||"Grid");H(M.codeType);h.setValue(i(M.codeBody));h.clearSelection();g("#codeDetails").find("input.codeSummary").focus();g("#codeDetailsInfo").addClass("none");g("#codeDetails").removeClass("none");localStorage.setItem("lastAccessedCustomCodeId",L)}function f(L){g("#customCodeList tr").removeClass("highlightRow");L.addClass("highlightRow")}function i(M){if(M){var L=M.replace(/&#39;/g,"'");L=L.replace(/&#34;/g,'"');L=L.replace(/&lt;/g,"<");L=L.replace(/&gt;/g,">");L=L.replace(/&amp;/g,"&");return L}return M}return{setProps:n,init:D,TYPE_GLOBAL_CSS:r,TYPE_GLOBAL_JS:o,TYPE_CSS:q,TYPE_JAVASCRIPT:v}})(window,document,jq);var GBMixpanel=(function(d,e,b){function h(j){if(i()){return}mixpanel.init(j,{cross_site_cookie:true})}function a(j,k){if(i()){return}if(!k){k={}}var l=b.extend({},k,{"Org ID":orgId,"GridBuddy Edition":gbEdition,"GridBuddy Version":gridBuddyVersion,"User ID":userId,"User Type":abbreviatedUserType,"UI Theme":uiTheme,"User Language":userLanguage,"Lightning Style Enabled":lightningStylesEnabled,"OS Version":f()});mixpanel.track(j,l);mixpanel.people.set({"User ID":userId,"User Type":uiTheme,"UI Theme":abbreviatedUserType,"User Language":userLanguage});mixpanel.identify(userId)}function f(){var l="Unknown OS";var k=navigator.userAgent;if(k&&(k.indexOf("Firefox")==-1)){var j=navigator.appVersion;if(j.indexOf("Mac")!=-1){l=j.match(/([Mac]+.+)/)[1]}else{if(j.indexOf("Windows")){l=j.match(/([Windows]+.+)/)[1]}}}else{if(k.indexOf("Firefox")!=-1){l=navigator.oscpu}}return l}function c(){if(i()){return}var j=g();a("MCC Save",j)}function g(){var l={},n=false,j=false,o=0,m=0,k;b("#customCodeList .codeRow .codeType").each(function(){k=b(this).text();if(k==GBCustomCodeConfig.TYPE_GLOBAL_JS){n=true;o++}else{if(k==GBCustomCodeConfig.TYPE_GLOBAL_CSS){j=true;m++}else{if(k==GBCustomCodeConfig.TYPE_CSS){m++}else{if(k==GBCustomCodeConfig.TYPE_JAVASCRIPT){o++}}}}});return{"Has Global JS":n,"Has Global CSS":j,"# JS Components":o,"# CSS Components":m}}function i(){if(isTrackingDisabled||(typeof mixpanel=="undefined")){return true}return false}return{init:h,track:a,trackSave:c}})(window,document,jq);