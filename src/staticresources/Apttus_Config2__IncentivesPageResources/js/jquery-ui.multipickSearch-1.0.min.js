/*
 *  Apttus Config & Pricing
 *
 *  @2015-2016 Apttus Inc. All rights reserved.
 *
 *  Project: Incentives
 *  Description: allows for auto complete search as well as multi pick feature
 *  allowing the user to choose multiple options at a time
 *  Author: Ian Gallagher - Apttus
 */
(function(c,J,H,g){function l(a,g){this.element=a;this.options=c.extend({data:[],onDelete:function(a){},onItemSelected:function(a,c){},multipick:!0,propNameLabel:"label",propNameValue:"value",initialItems:null,disallowDuplicate:!0,defaultResults:null,cssClassMultipickSearch:"multi-select-widget",resultsSearch:function(a,c){var g=[];for(i=0;i<c.length;i++)-1<c[i].label.toLowerCase().toLowerCase().indexOf(a.toLowerCase())&&g.push(c[i]);return g},lblResultsItemsTitle:"Available Items",lblSelectedItemsTitle:"Selected Items",
    lblClose:"Close",lblNoResults:"No Results Available"},g);this._defaults=r;this.info={queryTerm:null,isDefaultSearch:!1,data:[]};this.init()}var r={};l.prototype.init=function(){var a=this;c(a.element);var n,m,h,p="<div class='control-counter-container'><span class='circle-btn cancel-btn' style='display:none;'><i class='fa fa-times'></i></span>"+(a.options.multipick?"<span class='counter'></span>":"")+"</div>";a.info.$searchInput=c(a.element);a.info.$searchInput.wrap("<div class='"+a.options.cssClassMultipickSearch+
    "'></div>").after(p).before("<span class='search-container'><i class='fa fa-search'></i></span>");var k=a.info.$searchInput.closest("."+a.options.cssClassMultipickSearch),x=k.find(".search-container"),t=k.find(".cancel-btn"),y=function(){t.attr("style","display:inline-block");q(a)},u=function(){t.hide();q(a)},p=function(){$this=c(this);""!==$this.val()?y.call(a,$this):u.call(a,$this)},v=function(d,b){if(null!==b&&b.length)d(b);else{var e={};e.label=a.options.lblNoResults;e.value=null;d([e])}};a.info.$controlsContainer=
    k.find(".control-counter-container");n=k.width();x.outerWidth(!0);a.$counter=k.find(".counter");a.$counter.bind("click",function(){z(a.info.data);a.info.$resultsMenuElement.hide();a.$selectedItemsList.addClass("open")});a.info.$searchInput.on("keyup",p);a.info.$searchInput.on("change",p);a.info.$searchInput.on("focus",function(){""!==c(this).val()&&y.call(a)});a.info.$searchInput.on("blur",function(){""===c(this).val()&&u.call(a,c(this))});t.bind("click",function(){var d=c(this);a.info.$searchInput.val("");
    u.call(a,d)});a.$selectedItemsList=c("<div class='selected-list'></div>");c("body").append(a.$selectedItemsList);h=a.info.$searchInput.autocomplete({source:function(d,b){a.info.queryTerm=d.term;h.menu.element.hide();a.options.isDefaultSearch?a.options.defaultResults(d,function(a){v(b,a)}):a.options.dataSourceFunction!==g?a.options.dataSourceFunction(d,function(a){v(b,a)}):v(b,a.resultsSearch(d.term,a.options.data))},search:function(){a.$selectedItemsList.removeClass("open")},messages:{noResults:"",
    results:function(){}},select:function(d,b){if(a.options.multipick){var e=d.originalEvent,f;e.srcElement!==g&&null!==e.srcElement&&(f="LI"===e.srcElement.tagName?e.srcElement:c(e.srcElement).closest("li"));$itemEle=c(f);0===$itemEle.has(".fa-check-circle").length&&$itemEle.append("<i class='fa fa-check-circle'></i>");w(b.item,d,g,a);return!1}m=b.item;a.options.onItemSelected(a.options,m);a.info.$searchInput.val(m.label)},open:function(d,b){a.options.isDefaultSearch&&(a.options.isDefaultSearch=!1);
    var e=k.offset(),f=k.height();a.info.$resultsMenuElement.css({"min-width":k.outerWidth()+"px",left:e.left,top:e.top+f});a.options.multipick&&(a.info.$resultsMenuElement.find("li").first().removeClass("ui-menu-item"),c.each(a.info.$resultsMenuElement.find("li.ui-menu-item"),function(d,b){$item=c(b);for(i=0;i<a.info.data.length;i++)$item.data("autocomplete.item").value===a.info.data[i].value&&$item.append("<i class='fa fa-check-circle'></i>")}))}}).data("ui-autocomplete");a.info.$resultsMenuElement=
    h.menu.element;if(a.options.multipick)h._close=function(a,b){};else{var r=h.close;h.close=function(d){r.apply(this,arguments);var b;m!=g&&(b=m.label);a.info.$searchInput.val(b)}}h._renderItem=function(d,b){var e,f=null!==b.value;e=!a.options.isDefaultSearch&&f?"<a>"+b.label.replace(new RegExp("("+(a.info.queryTerm+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")+")","gi"),"<b>$1</b>")+"</a>":f?"<a>"+b.label+"</a>":"<span>"+b.label+"</span>";return c("<li></li>").attr("class",f?"ui-menu-item":
    "ui-menu-item-status").data("autocomplete.item",b).append(e).appendTo(d)};h._renderMenu=function(d,b){if(a.options.multipick&&(1!==b.length||null!==b[0].value)){a.info._$resultsCloseBtn=A(B);var e=C(a.options.lblResultsItemsTitle,a.info._$resultsCloseBtn);c("<li/>").attr("class","initial-menu-item").append(e).appendTo(d)}var f=this;c.each(b,function(a,b){f._renderItemData(d,b)})};var B=function(){this.info.$searchInput.val("");this.info.$searchInput.change();this.info.$resultsMenuElement.hide()},
    D=function(){this.$selectedItemsList.removeClass("open")},F=function(a,b){a.options.onDelete(a.options,b);a.info.data=jQuery.grep(a.info.data,function(a){return a.value!==b.value});E(a)},I=function(){$this=c(this);var d=$this.closest("li"),b=d.data("item");F(a,b);d.remove();$this.parent().remove();$this.remove()},q=function(a){var b=0,e=a.info.$controlsContainer.outerWidth(!0);a.info.$controlsContainer.children().each(function(){b+=c(this).outerWidth(!0)});e=n-x.outerWidth(!0)-(e>b?e:b);0<e&&a.info.$searchInput.width(e-
        2)};q(a);if(null!==a.options.defaultResults){var G=function(){a.options.isDefaultSearch||""!==c(this).val()||"none"!==a.info.$resultsMenuElement.css("display")||(a.options.isDefaultSearch=!0,a.info.$searchInput.autocomplete("search","a"))};a.info.$searchInput.bind("focus",function(){G.call(this)});a.info.$searchInput.bind("click",function(){G.call(this)});a.info.$searchInput.bind("keyup",function(){""===c(this).val()&&(a.options.isDefaultSearch=!0,a.info.$searchInput.autocomplete("search","a"))})}var A=
    function(d){return c("<span></span>").attr("class","close").html(a.options.lblClose).bind("click",function(){d.call(a)})},C=function(a,b){return c("<div/>").attr("class","initial-item").append("<span>"+a+"</span>").append(b)},E=function(a){if(a.options.multipick){var b=a.info.data.length;0===b?(a.$counter.text(""),a.$selectedItemsList.removeClass("open")):a.$counter.text(b);q(a)}},z=function(d){var b=k.offset(),e=k.height();a.$selectedItemsList.css({left:b.left,top:b.top+e,"min-width":k.outerWidth()+
"px"});0<a.$selectedItemsList.find("ul").length?ul=a.$selectedItemsList.html("<ul></ul>").find("ul"):(ul=c("<ul></ul>"),a.$selectedItemsList.append(ul));a.info._$selectedItemsCloseBtn=A(D);C(a.options.lblSelectedItemsTitle,a.info._$selectedItemsCloseBtn).insertBefore(ul);for(b=0;b<d.length;b++){var f=c("<div/>").attr("class","circle-btn cancel-btn delete").append(c("<i/>").attr("class","fa fa-times"));f.on("click",I);e=c("<li/>").attr("class","selected-item").data("item",d[b]);f=c("<div/>").attr("class",
    "item-container").append("<span data-value='"+d[b].value+"'>"+d[b].label+"</span>").append(f);e.append(f).appendTo(ul)}},w=function(a,b,c,f){c=c===g?!0:c;if(b=f.options.multipick&&f.options.disallowDuplicate)a:{b=f.info.data;var h=a.value;for(i=0;i<b.length;i++)if(b[i].value==h){b=!0;break a}b=void 0}if(!b){if(c)f.options.onItemSelected(f.options,a);f.info.data.push(a);z(f.info.data);E(f)}};l.prototype._onDocumentClick=function(a){this.info.$searchInput.is(a.target)||this.info.$resultsMenuElement.is(a.target)||
this.$selectedItemsList.is(a.target)||0!==this.info.$resultsMenuElement.has(a.target).length||0!==this.$selectedItemsList.has(a.target).length||(a="none"!==this.info.$resultsMenuElement.css("display"),(this.info._$resultsCloseBtn!==g&&1===this.info._$resultsCloseBtn.length||a)&&B.call(this),this.info._$selectedItemsCloseBtn!==g&&1===this.info._$selectedItemsCloseBtn.length&&D.call(this))};c(H).mouseup(function(c){a._onDocumentClick.call(a,c)});l.prototype.settings=function(){return a.options};l.prototype.uiAutoCompleteHndl=
    function(){return h};l.prototype.addSelectedItem=function(a){w(a,null,!0,this)};l.prototype.setSelectedItems=function(a,b){for(i=this.info.data.length-1;0<=i;i--)F(this,this.info.data[i]);for(i=0;i<a.length;i++)w(a[i],g,b===g?!0:b,this)};l.prototype.resultsSearch=function(a,b){var c=[];for(i=0;i<b.length;i++)-1<b[i].label.toLowerCase().toLowerCase().indexOf(a.toLowerCase())&&c.push(b[i]);return c}};c.fn.multipickSearch=function(a){var n=arguments;if(a===g||"object"===typeof a)return this.each(function(){c.data(this,
    "plugin_multipickSearch")||c.data(this,"plugin_multipickSearch",new l(this,a))});if("string"===typeof a&&"_"!==a[0]&&"init"!==a){var m;this.each(function(){var g=c.data(this,"plugin_multipickSearch");g instanceof l&&"function"===typeof g[a]&&(m=g[a].apply(g,Array.prototype.slice.call(n,1)));"destroy"===a&&c.data(this,"plugin_multipickSearch",null)});return m!==g?m:this}}})(jQuery,window,document,void 0);